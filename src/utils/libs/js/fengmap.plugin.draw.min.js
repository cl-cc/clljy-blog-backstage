/**Released Version v3.1.3,BUILD 653,Time 1691032747035. Fengmap Javascript SDK , see: https://www.fengmap.com for details**/
!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?exports.fengmap=i():t.fengmap=i()}(this,function(){return n=[function(_,F,L){"use strict";L.r(F);for(var r=[],D=0;D<256;D++)r[D]=(D<16?"0":"")+D.toString(16);var d={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0,s=4294967295*Math.random()|0;return(r[255&t]+r[t>>8&255]+r[t>>16&255]+r[t>>24&255]+"-"+r[255&i]+r[i>>8&255]+"-"+r[i>>16&15|64]+r[i>>24&255]+"-"+r[63&n|128]+r[n>>8&255]+"-"+r[n>>16&255]+r[n>>24&255]+r[255&s]+r[s>>8&255]+r[s>>16&255]+r[s>>24&255]).toUpperCase()},clamp:function(t,i,n){return Math.max(i,Math.min(n,t))},euclideanModulo:function(t,i){return(t%i+i)%i},mapLinear:function(t,i,n,s,r){return s+(t-i)*(r-s)/(n-i)},lerp:function(t,i,n){return(1-n)*t+n*i},smoothstep:function(t,i,n){return t<=i?0:n<=t?1:(t=(t-i)/(n-i))*t*(3-2*t)},smootherstep:function(t,i,n){return t<=i?0:n<=t?1:(t=(t-i)/(n-i))*t*t*(t*(6*t-15)+10)},randInt:function(t,i){return t+Math.floor(Math.random()*(i-t+1))},randFloat:function(t,i){return t+Math.random()*(i-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*d.DEG2RAD},radToDeg:function(t){return t*d.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,i,n,s,r){var e=Math.cos,h=Math.sin,o=e(n/2),n=h(n/2),u=e((i+s)/2),a=h((i+s)/2),c=e((i-s)/2),f=h((i-s)/2),e=e((s-i)/2),h=h((s-i)/2);"XYX"===r?t.set(o*a,n*c,n*f,o*u):"YZY"===r?t.set(n*f,o*a,n*c,o*u):"ZXZ"===r?t.set(n*c,n*f,o*a,o*u):"XZX"===r?t.set(o*a,n*h,n*e,o*u):"YXY"===r?t.set(n*e,o*a,n*h,o*u):"ZYZ"===r?t.set(n*h,n*e,o*a,o*u):console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order.")}};function e(t,i,n,s){this.u=t||0,this.v=i||0,this.M=n||0,this.A=void 0!==s?s:1}Object.assign(e,{slerp:function(t,i,n,s){return n.copy(t).slerp(i,s)},slerpFlat:function(t,i,n,s,r,e,h){var o,u,a,c=n[s+0],f=n[s+1],l=n[s+2],n=n[s+3],s=r[e+0],v=r[e+1],d=r[e+2],r=r[e+3];n===r&&c===s&&f===v&&l===d||(e=1-h,o=0<=(u=c*s+f*v+l*d+n*r)?1:-1,(a=1-u*u)>Number.EPSILON&&(a=Math.sqrt(a),u=Math.atan2(a,u*o),e=Math.sin(e*u)/a,h=Math.sin(h*u)/a),c=c*e+s*(u=h*o),f=f*e+v*u,l=l*e+d*u,n=n*e+r*u,e===1-h&&(c*=a=1/Math.sqrt(c*c+f*f+l*l+n*n),f*=a,l*=a,n*=a)),t[i]=c,t[i+1]=f,t[i+2]=l,t[i+3]=n}}),Object.defineProperties(e.prototype,{x:{get:function(){return this.u},set:function(t){this.u=t,this.S()}},y:{get:function(){return this.v},set:function(t){this.v=t,this.S()}},z:{get:function(){return this.M},set:function(t){this.M=t,this.S()}},w:{get:function(){return this.A},set:function(t){this.A=t,this.S()}}}),Object.assign(e.prototype,{isQuaternion:!0,set:function(t,i,n,s){return this.u=t,this.v=i,this.M=n,this.A=s,this.S(),this},clone:function(){return new this.constructor(this.u,this.v,this.M,this.A)},copy:function(t){return this.u=t.x,this.v=t.y,this.M=t.z,this.A=t.w,this.S(),this},setFromEuler:function(t,i){var n,s,r,e,h,o,u;if(t&&t.isEuler)return h=t.u,o=t.v,n=t.M,t=t.order,e=Math.cos,u=Math.sin,s=e(h/2),r=e(o/2),e=e(n/2),h=u(h/2),o=u(o/2),u=u(n/2),"XYZ"===t?(this.u=h*r*e+s*o*u,this.v=s*o*e-h*r*u,this.M=s*r*u+h*o*e,this.A=s*r*e-h*o*u):"YXZ"===t?(this.u=h*r*e+s*o*u,this.v=s*o*e-h*r*u,this.M=s*r*u-h*o*e,this.A=s*r*e+h*o*u):"ZXY"===t?(this.u=h*r*e-s*o*u,this.v=s*o*e+h*r*u,this.M=s*r*u+h*o*e,this.A=s*r*e-h*o*u):"ZYX"===t?(this.u=h*r*e-s*o*u,this.v=s*o*e+h*r*u,this.M=s*r*u-h*o*e,this.A=s*r*e+h*o*u):"YZX"===t?(this.u=h*r*e+s*o*u,this.v=s*o*e+h*r*u,this.M=s*r*u-h*o*e,this.A=s*r*e-h*o*u):"XZY"===t&&(this.u=h*r*e-s*o*u,this.v=s*o*e-h*r*u,this.M=s*r*u+h*o*e,this.A=s*r*e+h*o*u),!1!==i&&this.S(),this;throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.")},setFromAxisAngle:function(t,i){var i=i/2,n=Math.sin(i);return this.u=t.x*n,this.v=t.y*n,this.M=t.z*n,this.A=Math.cos(i),this.S(),this},setFromRotationMatrix:function(t){var i,t=t.elements,n=t[0],s=t[4],r=t[8],e=t[1],h=t[5],o=t[9],u=t[2],a=t[6],t=t[10],c=n+h+t;return 0<c?(i=.5/Math.sqrt(c+1),this.A=.25/i,this.u=(a-o)*i,this.v=(r-u)*i,this.M=(e-s)*i):h<n&&t<n?(i=2*Math.sqrt(1+n-h-t),this.A=(a-o)/i,this.u=.25*i,this.v=(s+e)/i,this.M=(r+u)/i):t<h?(i=2*Math.sqrt(1+h-n-t),this.A=(r-u)/i,this.u=(s+e)/i,this.v=.25*i,this.M=(o+a)/i):(i=2*Math.sqrt(1+t-n-h),this.A=(e-s)/i,this.u=(r+u)/i,this.v=(o+a)/i,this.M=.25*i),this.S(),this},setFromUnitVectors:function(t,i){var n=t.dot(i)+1;return n<1e-6?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this.u=-t.y,this.v=t.x,this.M=0):(this.u=0,this.v=-t.z,this.M=t.y)):(this.u=t.y*i.z-t.z*i.y,this.v=t.z*i.x-t.x*i.z,this.M=t.x*i.y-t.y*i.x),this.A=n,this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(d.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,i){var n=this.angleTo(t);return 0!==n&&(i=Math.min(1,i/n),this.slerp(t,i)),this},inverse:function(){return this.conjugate()},conjugate:function(){return this.u*=-1,this.v*=-1,this.M*=-1,this.S(),this},dot:function(t){return this.u*t.u+this.v*t.v+this.M*t.M+this.A*t.A},lengthSq:function(){return this.u*this.u+this.v*this.v+this.M*this.M+this.A*this.A},length:function(){return Math.sqrt(this.u*this.u+this.v*this.v+this.M*this.M+this.A*this.A)},normalize:function(){var t=this.length();return 0===t?(this.u=0,this.v=0,this.M=0,this.A=1):(this.u=this.u*(t=1/t),this.v=this.v*t,this.M=this.M*t,this.A=this.A*t),this.S(),this},multiply:function(t,i){return void 0!==i?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,i)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,i){var n=t.u,s=t.v,r=t.M,t=t.A,e=i.u,h=i.v,o=i.M,i=i.A;return this.u=n*i+t*e+s*o-r*h,this.v=s*i+t*h+r*e-n*o,this.M=r*i+t*o+n*h-s*e,this.A=t*i-n*e-s*h-r*o,this.S(),this},slerp:function(t,i){if(0!==i){if(1===i)return this.copy(t);var n,s=this.u,r=this.v,e=this.M,h=this.A,o=h*t.A+s*t.u+r*t.v+e*t.M;o<0?(this.A=-t.A,this.u=-t.u,this.v=-t.v,this.M=-t.M,o=-o):this.copy(t),1<=o?(this.A=h,this.u=s,this.v=r,this.M=e):((t=1-o*o)<=Number.EPSILON?(this.A=(n=1-i)*h+i*this.A,this.u=n*s+i*this.u,this.v=n*r+i*this.v,this.M=n*e+i*this.M,this.normalize()):(n=Math.sqrt(t),t=Math.atan2(n,o),o=Math.sin((1-i)*t)/n,i=Math.sin(i*t)/n,this.A=h*o+this.A*i,this.u=s*o+this.u*i,this.v=r*o+this.v*i,this.M=e*o+this.M*i),this.S())}return this},equals:function(t){return t.u===this.u&&t.v===this.v&&t.M===this.M&&t.A===this.A},fromArray:function(t,i){return this.u=t[i=void 0===i?0:i],this.v=t[i+1],this.M=t[i+2],this.A=t[i+3],this.S(),this},toArray:function(t,i){return(t=void 0===t?[]:t)[i=void 0===i?0:i]=this.u,t[i+1]=this.v,t[i+2]=this.M,t[i+3]=this.A,t},fromBufferAttribute:function(t,i){return this.u=t.getX(i),this.v=t.getY(i),this.M=t.getZ(i),this.A=t.getW(i),this},R:function(t){return this.S=t,this},S:function(){}});var H=new w,Y=new e;function w(t,i,n){this.x=t||0,this.y=i||0,this.z=n||0}Object.assign(w.prototype,{isVector3:!0,set:function(t,i,n){return this.x=t,this.y=i,this.z=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},addScaledVector:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this},sub:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},multiply:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,i)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this},applyEuler:function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Y.setFromEuler(t))},applyAxisAngle:function(t,i){return this.applyQuaternion(Y.setFromAxisAngle(t,i))},applyMatrix3:function(t){var i=this.x,n=this.y,s=this.z,t=t.elements;return this.x=t[0]*i+t[3]*n+t[6]*s,this.y=t[1]*i+t[4]*n+t[7]*s,this.z=t[2]*i+t[5]*n+t[8]*s,this},applyNormalMatrix:function(t){return this.applyMatrix3(t).normalize()},applyMatrix4:function(t){var i=this.x,n=this.y,s=this.z,t=t.elements,r=1/(t[3]*i+t[7]*n+t[11]*s+t[15]);return this.x=(t[0]*i+t[4]*n+t[8]*s+t[12])*r,this.y=(t[1]*i+t[5]*n+t[9]*s+t[13])*r,this.z=(t[2]*i+t[6]*n+t[10]*s+t[14])*r,this},applyQuaternion:function(t){var i=this.x,n=this.y,s=this.z,r=t.x,e=t.y,h=t.z,t=t.w,o=t*i+e*s-h*n,u=t*n+h*i-r*s,a=t*s+r*n-e*i,i=-r*i-e*n-h*s;return this.x=o*t+i*-r+u*-h-a*-e,this.y=u*t+i*-e+a*-r-o*-h,this.z=a*t+i*-h+o*-e-u*-r,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var i=this.x,n=this.y,s=this.z,t=t.elements;return this.x=t[0]*i+t[4]*n+t[8]*s,this.y=t[1]*i+t[5]*n+t[9]*s,this.z=t[2]*i+t[6]*n+t[10]*s,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this},clampScalar:function(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this},clampLength:function(t,i){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(i,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this},lerpVectors:function(t,i,n){return this.subVectors(i,t).multiplyScalar(n).add(t)},cross:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,i)):this.crossVectors(this,t)},crossVectors:function(t,i){var n=t.x,s=t.y,t=t.z,r=i.x,e=i.y,i=i.z;return this.x=s*i-t*e,this.y=t*r-n*i,this.z=n*e-s*r,this},projectOnVector:function(t){var i=t.lengthSq();return 0===i?this.set(0,0,0):(i=t.dot(this)/i,this.copy(t).multiplyScalar(i))},projectOnPlane:function(t){return H.copy(this).projectOnVector(t),this.sub(H)},reflect:function(t){return this.sub(H.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){var i=Math.sqrt(this.lengthSq()*t.lengthSq());return 0===i?Math.PI/2:(t=this.dot(t)/i,Math.acos(d.clamp(t,-1,1)))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x,n=this.y-t.y,t=this.z-t.z;return i*i+n*n+t*t},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,i,n){var s=Math.sin(i)*t;return this.x=s*Math.sin(n),this.y=Math.cos(i)*t,this.z=s*Math.cos(n),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,i,n){return this.x=t*Math.sin(i),this.y=n,this.z=t*Math.cos(i),this},setFromMatrixPosition:function(t){t=t.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(t){var i=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),t=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=n,this.z=t,this},setFromMatrixColumn:function(t,i){return this.fromArray(t.elements,4*i)},setFromMatrix3Column:function(t,i){return this.fromArray(t.elements,3*i)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,i){return this.x=t[i=void 0===i?0:i],this.y=t[i+1],this.z=t[i+2],this},toArray:function(t,i){return(t=void 0===t?[]:t)[i=void 0===i?0:i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t},fromBufferAttribute:function(t,i,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this}});var u=new w,a=new y,N=new w(0,0,0),X=new w(1,1,1),h=new w,U=new w,o=new w;function y(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function Z(){this.type="Curve",this.arcLengthDivisions=200}function E(t,i){this.x=t||0,this.y=i||0}function G(t,i,n,s,r,e,h,o){Z.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=i||0,this.xRadius=n||1,this.yRadius=s||1,this.aStartAngle=r||0,this.aEndAngle=e||2*Math.PI,this.aClockwise=h||!1,this.aRotation=o||0}Object.assign(y.prototype,{isMatrix4:!0,set:function(t,i,n,s,r,e,h,o,u,a,c,f,l,v,d,y){var p=this.elements;return p[0]=t,p[4]=i,p[8]=n,p[12]=s,p[1]=r,p[5]=e,p[9]=h,p[13]=o,p[2]=u,p[6]=a,p[10]=c,p[14]=f,p[3]=l,p[7]=v,p[11]=d,p[15]=y,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new y).fromArray(this.elements)},copy:function(t){var i=this.elements,t=t.elements;return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],this},copyPosition:function(t){var i=this.elements,t=t.elements;return i[12]=t[12],i[13]=t[13],i[14]=t[14],this},extractBasis:function(t,i,n){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(t,i,n){return this.set(t.x,i.x,n.x,0,t.y,i.y,n.y,0,t.z,i.z,n.z,0,0,0,0,1),this},extractRotation:function(t){var i=this.elements,n=t.elements,s=1/u.setFromMatrixColumn(t,0).length(),r=1/u.setFromMatrixColumn(t,1).length(),t=1/u.setFromMatrixColumn(t,2).length();return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=0,i[4]=n[4]*r,i[5]=n[5]*r,i[6]=n[6]*r,i[7]=0,i[8]=n[8]*t,i[9]=n[9]*t,i[10]=n[10]*t,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this},makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var i,n,s,r,e,h,o,u,a,c,f,l,v=this.elements,d=t.x,y=t.y,p=t.z,m=Math.cos(d),d=Math.sin(d),b=Math.cos(y),y=Math.sin(y),M=Math.cos(p),p=Math.sin(p);return"XYZ"===t.order?(e=m*M,h=m*p,o=d*M,u=d*p,v[0]=b*M,v[4]=-b*p,v[8]=y,v[1]=h+o*y,v[5]=e-u*y,v[9]=-d*b,v[2]=u-e*y,v[6]=o+h*y,v[10]=m*b):"YXZ"===t.order?(n=b*p,s=y*M,v[0]=(i=b*M)+(r=y*p)*d,v[4]=s*d-n,v[8]=m*y,v[1]=m*p,v[5]=m*M,v[9]=-d,v[2]=n*d-s,v[6]=r+i*d,v[10]=m*b):"ZXY"===t.order?(n=b*p,s=y*M,v[0]=(i=b*M)-(r=y*p)*d,v[4]=-m*p,v[8]=s+n*d,v[1]=n+s*d,v[5]=m*M,v[9]=r-i*d,v[2]=-m*y,v[6]=d,v[10]=m*b):"ZYX"===t.order?(e=m*M,h=m*p,o=d*M,u=d*p,v[0]=b*M,v[4]=o*y-h,v[8]=e*y+u,v[1]=b*p,v[5]=u*y+e,v[9]=h*y-o,v[2]=-y,v[6]=d*b,v[10]=m*b):"YZX"===t.order?(a=m*b,c=m*y,f=d*b,l=d*y,v[0]=b*M,v[4]=l-a*p,v[8]=f*p+c,v[1]=p,v[5]=m*M,v[9]=-d*M,v[2]=-y*M,v[6]=c*p+f,v[10]=a-l*p):"XZY"===t.order&&(a=m*b,c=m*y,f=d*b,l=d*y,v[0]=b*M,v[4]=-p,v[8]=y*M,v[1]=a*p+l,v[5]=m*M,v[9]=c*p-f,v[2]=f*p-c,v[6]=d*M,v[10]=l*p+a),v[3]=0,v[7]=0,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,this},makeRotationFromQuaternion:function(t){return this.compose(N,t,X)},lookAt:function(t,i,n){var s=this.elements;return o.subVectors(t,i),0===o.lengthSq()&&(o.z=1),o.normalize(),h.crossVectors(n,o),0===h.lengthSq()&&(1===Math.abs(n.z)?o.x+=1e-4:o.z+=1e-4,o.normalize(),h.crossVectors(n,o)),h.normalize(),U.crossVectors(o,h),s[0]=h.x,s[4]=U.x,s[8]=o.x,s[1]=h.y,s[5]=U.y,s[9]=o.y,s[2]=h.z,s[6]=U.z,s[10]=o.z,this},multiply:function(t,i){return void 0!==i?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,i)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,i){var t=t.elements,i=i.elements,n=this.elements,s=t[0],r=t[4],e=t[8],h=t[12],o=t[1],u=t[5],a=t[9],c=t[13],f=t[2],l=t[6],v=t[10],d=t[14],y=t[3],p=t[7],m=t[11],t=t[15],b=i[0],M=i[4],w=i[8],g=i[12],A=i[1],E=i[5],S=i[9],R=i[13],j=i[2],x=i[6],O=i[10],T=i[14],k=i[3],B=i[7],I=i[11],i=i[15];return n[0]=s*b+r*A+e*j+h*k,n[4]=s*M+r*E+e*x+h*B,n[8]=s*w+r*S+e*O+h*I,n[12]=s*g+r*R+e*T+h*i,n[1]=o*b+u*A+a*j+c*k,n[5]=o*M+u*E+a*x+c*B,n[9]=o*w+u*S+a*O+c*I,n[13]=o*g+u*R+a*T+c*i,n[2]=f*b+l*A+v*j+d*k,n[6]=f*M+l*E+v*x+d*B,n[10]=f*w+l*S+v*O+d*I,n[14]=f*g+l*R+v*T+d*i,n[3]=y*b+p*A+m*j+t*k,n[7]=y*M+p*E+m*x+t*B,n[11]=y*w+p*S+m*O+t*I,n[15]=y*g+p*R+m*T+t*i,this},multiplyScalar:function(t){var i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this},determinant:function(){var t=this.elements,i=t[0],n=t[4],s=t[8],r=t[12],e=t[1],h=t[5],o=t[9],u=t[13],a=t[2],c=t[6],f=t[10],l=t[14];return t[3]*(+r*o*c-s*u*c-r*h*f+n*u*f+s*h*l-n*o*l)+t[7]*(+i*o*l-i*u*f+r*e*f-s*e*l+s*u*a-r*o*a)+t[11]*(+i*u*c-i*h*l-r*e*c+n*e*l+r*h*a-n*u*a)+t[15]*(-s*h*a-i*o*c+i*h*f+s*e*c-n*e*f+n*o*a)},transpose:function(){var t=this.elements,i=t[1];return t[1]=t[4],t[4]=i,i=t[2],t[2]=t[8],t[8]=i,i=t[6],t[6]=t[9],t[9]=i,i=t[3],t[3]=t[12],t[12]=i,i=t[7],t[7]=t[13],t[13]=i,i=t[11],t[11]=t[14],t[14]=i,this},setPosition:function(t,i,n){var s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=i,s[14]=n),this},getInverse:function(t,i){void 0!==i&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");var i=this.elements,t=t.elements,n=t[0],s=t[1],r=t[2],e=t[3],h=t[4],o=t[5],u=t[6],a=t[7],c=t[8],f=t[9],l=t[10],v=t[11],d=t[12],y=t[13],p=t[14],t=t[15],m=f*p*a-y*l*a+y*u*v-o*p*v-f*u*t+o*l*t,b=d*l*a-c*p*a-d*u*v+h*p*v+c*u*t-h*l*t,M=c*y*a-d*f*a+d*o*v-h*y*v-c*o*t+h*f*t,w=d*f*u-c*y*u-d*o*l+h*y*l+c*o*p-h*f*p,g=n*m+s*b+r*M+e*w;return 0==g?this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0):(i[0]=m*(m=1/g),i[1]=(y*l*e-f*p*e-y*r*v+s*p*v+f*r*t-s*l*t)*m,i[2]=(o*p*e-y*u*e+y*r*a-s*p*a-o*r*t+s*u*t)*m,i[3]=(f*u*e-o*l*e-f*r*a+s*l*a+o*r*v-s*u*v)*m,i[4]=b*m,i[5]=(c*p*e-d*l*e+d*r*v-n*p*v-c*r*t+n*l*t)*m,i[6]=(d*u*e-h*p*e-d*r*a+n*p*a+h*r*t-n*u*t)*m,i[7]=(h*l*e-c*u*e+c*r*a-n*l*a-h*r*v+n*u*v)*m,i[8]=M*m,i[9]=(d*f*e-c*y*e-d*s*v+n*y*v+c*s*t-n*f*t)*m,i[10]=(h*y*e-d*o*e+d*s*a-n*y*a-h*s*t+n*o*t)*m,i[11]=(c*o*e-h*f*e-c*s*a+n*f*a+h*s*v-n*o*v)*m,i[12]=w*m,i[13]=(c*y*r-d*f*r+d*s*l-n*y*l-c*s*p+n*f*p)*m,i[14]=(d*o*r-h*y*r-d*s*u+n*y*u+h*s*p-n*o*p)*m,i[15]=(h*f*r-c*o*r+c*s*u-n*f*u-h*s*l+n*o*l)*m,this)},invert:function(){var t=this.elements,i=t[0],n=t[1],s=t[2],r=t[3],e=t[4],h=t[5],o=t[6],u=t[7],a=t[8],c=t[9],f=t[10],l=t[11],v=t[12],d=t[13],y=t[14],p=t[15],m=c*y*u-d*f*u+d*o*l-h*y*l-c*o*p+h*f*p,b=v*f*u-a*y*u-v*o*l+e*y*l+a*o*p-e*f*p,M=a*d*u-v*c*u+v*h*l-e*d*l-a*h*p+e*c*p,w=v*c*o-a*d*o-v*h*f+e*d*f+a*h*y-e*c*y,g=i*m+n*b+s*M+r*w;return 0==g?this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0):(t[0]=m*(m=1/g),t[1]=(d*f*r-c*y*r-d*s*l+n*y*l+c*s*p-n*f*p)*m,t[2]=(h*y*r-d*o*r+d*s*u-n*y*u-h*s*p+n*o*p)*m,t[3]=(c*o*r-h*f*r-c*s*u+n*f*u+h*s*l-n*o*l)*m,t[4]=b*m,t[5]=(a*y*r-v*f*r+v*s*l-i*y*l-a*s*p+i*f*p)*m,t[6]=(v*o*r-e*y*r-v*s*u+i*y*u+e*s*p-i*o*p)*m,t[7]=(e*f*r-a*o*r+a*s*u-i*f*u-e*s*l+i*o*l)*m,t[8]=M*m,t[9]=(v*c*r-a*d*r-v*n*l+i*d*l+a*n*p-i*c*p)*m,t[10]=(e*d*r-v*h*r+v*n*u-i*d*u-e*n*p+i*h*p)*m,t[11]=(a*h*r-e*c*r-a*n*u+i*c*u+e*n*l-i*h*l)*m,t[12]=w*m,t[13]=(a*d*s-v*c*s+v*n*f-i*d*f-a*n*y+i*c*y)*m,t[14]=(v*h*s-e*d*s-v*n*o+i*d*o+e*n*y-i*h*y)*m,t[15]=(e*c*s-a*h*s+a*n*o-i*c*o-e*n*f+i*h*f)*m,this)},scale:function(t){var i=this.elements,n=t.x,s=t.y,t=t.z;return i[0]*=n,i[4]*=s,i[8]*=t,i[1]*=n,i[5]*=s,i[9]*=t,i[2]*=n,i[6]*=s,i[10]*=t,i[3]*=n,i[7]*=s,i[11]*=t,this},getMaxScaleOnAxis:function(){var t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,n,t))},makeTranslation:function(t,i,n){return this.set(1,0,0,t,0,1,0,i,0,0,1,n,0,0,0,1),this},makeRotationX:function(t){var i=Math.cos(t),t=Math.sin(t);return this.set(1,0,0,0,0,i,-t,0,0,t,i,0,0,0,0,1),this},makeRotationY:function(t){var i=Math.cos(t),t=Math.sin(t);return this.set(i,0,t,0,0,1,0,0,-t,0,i,0,0,0,0,1),this},makeRotationZ:function(t){var i=Math.cos(t),t=Math.sin(t);return this.set(i,-t,0,0,t,i,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,i){var n=Math.cos(i),i=Math.sin(i),s=1-n,r=t.x,e=t.y,t=t.z,h=s*r,o=s*e;return this.set(h*r+n,h*e-i*t,h*t+i*e,0,h*e+i*t,o*e+n,o*t-i*r,0,h*t-i*e,o*t+i*r,s*t*t+n,0,0,0,0,1),this},makeScale:function(t,i,n){return this.set(t,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(t,i,n){return this.set(1,i,n,0,t,1,n,0,t,i,1,0,0,0,0,1),this},compose:function(t,i,n){var s=this.elements,r=i.u,e=i.v,h=i.M,i=i.A,o=r+r,u=e+e,a=h+h,c=r*o,f=r*u,r=r*a,l=e*u,e=e*a,h=h*a,o=i*o,u=i*u,i=i*a,a=n.x,v=n.y,n=n.z;return s[0]=(1-(l+h))*a,s[1]=(f+i)*a,s[2]=(r-u)*a,s[3]=0,s[4]=(f-i)*v,s[5]=(1-(c+h))*v,s[6]=(e+o)*v,s[7]=0,s[8]=(r+u)*n,s[9]=(e-o)*n,s[10]=(1-(c+l))*n,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this},decompose:function(t,i,n){var s=this.elements,r=u.set(s[0],s[1],s[2]).length(),e=u.set(s[4],s[5],s[6]).length(),h=u.set(s[8],s[9],s[10]).length(),t=(this.determinant()<0&&(r=-r),t.x=s[12],t.y=s[13],t.z=s[14],a.copy(this),1/r),s=1/e,o=1/h;return a.elements[0]*=t,a.elements[1]*=t,a.elements[2]*=t,a.elements[4]*=s,a.elements[5]*=s,a.elements[6]*=s,a.elements[8]*=o,a.elements[9]*=o,a.elements[10]*=o,i.setFromRotationMatrix(a),n.x=r,n.y=e,n.z=h,this},makePerspective:function(t,i,n,s,r,e){void 0===e&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var h=this.elements,o=2*r/(n-s),u=(i+t)/(i-t),n=(n+s)/(n-s),s=-(e+r)/(e-r),e=-2*e*r/(e-r);return h[0]=2*r/(i-t),h[4]=0,h[8]=u,h[12]=0,h[1]=0,h[5]=o,h[9]=n,h[13]=0,h[2]=0,h[6]=0,h[10]=s,h[14]=e,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this},makeOrthographic:function(t,i,n,s,r,e){var h=this.elements,o=1/(i-t),u=1/(n-s),a=1/(e-r),i=(i+t)*o,t=(n+s)*u,n=(e+r)*a;return h[0]=2*o,h[4]=0,h[8]=0,h[12]=-i,h[1]=0,h[5]=2*u,h[9]=0,h[13]=-t,h[2]=0,h[6]=0,h[10]=-2*a,h[14]=-n,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this},equals:function(t){for(var i=this.elements,n=t.elements,s=0;s<16;s++)if(i[s]!==n[s])return!1;return!0},fromArray:function(t,i){void 0===i&&(i=0);for(var n=0;n<16;n++)this.elements[n]=t[n+i];return this},toArray:function(t,i){var n=this.elements;return(t=void 0===t?[]:t)[i=void 0===i?0:i]=n[0],t[i+1]=n[1],t[i+2]=n[2],t[i+3]=n[3],t[i+4]=n[4],t[i+5]=n[5],t[i+6]=n[6],t[i+7]=n[7],t[i+8]=n[8],t[i+9]=n[9],t[i+10]=n[10],t[i+11]=n[11],t[i+12]=n[12],t[i+13]=n[13],t[i+14]=n[14],t[i+15]=n[15],t}}),Object.assign(Z.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,i){t=this.getUtoTmapping(t);return this.getPoint(t,i)},getPoints:function(t){void 0===t&&(t=5);for(var i=[],n=0;n<=t;n++)i.push(this.getPoint(n/t));return i},getSpacedPoints:function(t){void 0===t&&(t=5);for(var i=[],n=0;n<=t;n++)i.push(this.getPointAt(n/t));return i},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var i,n,s=[],r=this.getPoint(0),e=0;for(s.push(0),n=1;n<=t;n++)e+=(i=this.getPoint(n/t)).distanceTo(r),s.push(e),r=i;return this.cacheArcLengths=s},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,i){for(var n,s=this.getLengths(),r=0,e=s.length,h=i||t*s[e-1],o=0,u=e-1;o<=u;)if((n=s[r=Math.floor(o+(u-o)/2)]-h)<0)o=r+1;else{if(!(0<n)){u=r;break}u=r-1}return s[r=u]===h?r/(e-1):(r+(h-(i=s[r]))/(s[r+1]-i))/(e-1)},getTangent:function(t){var i=t-1e-4,t=t+1e-4,i=(1<t&&(t=1),this.getPoint(i=i<0?0:i));return this.getPoint(t).clone().sub(i).normalize()},getTangentAt:function(t){t=this.getUtoTmapping(t);return this.getTangent(t)},computeFrenetFrames:function(t,i){for(var n,s=new w,r=[],e=[],h=[],o=new w,u=new y,a=0;a<=t;a++)r[a]=this.getTangentAt(a/t),r[a].normalize();e[0]=new w,h[0]=new w;var c=Number.MAX_VALUE,f=Math.abs(r[0].x),l=Math.abs(r[0].y),v=Math.abs(r[0].z);for(f<=c&&(c=f,s.set(1,0,0)),l<=c&&(c=l,s.set(0,1,0)),v<=c&&s.set(0,0,1),o.crossVectors(r[0],s).normalize(),e[0].crossVectors(r[0],o),h[0].crossVectors(r[0],e[0]),a=1;a<=t;a++)e[a]=e[a-1].clone(),h[a]=h[a-1].clone(),o.crossVectors(r[a-1],r[a]),o.length()>Number.EPSILON&&(o.normalize(),n=Math.acos(d.clamp(r[a-1].dot(r[a]),-1,1)),e[a].applyMatrix4(u.makeRotationAxis(o,n))),h[a].crossVectors(r[a],e[a]);if(!0===i)for(n=Math.acos(d.clamp(e[0].dot(e[t]),-1,1)),n/=t,0<r[0].dot(o.crossVectors(e[0],e[t]))&&(n=-n),a=1;a<=t;a++)e[a].applyMatrix4(u.makeRotationAxis(r[a],n*a)),h[a].crossVectors(r[a],e[a]);return{tangents:r,normals:e,binormals:h}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),Object.defineProperties(E.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(E.prototype,{isVector2:!0,set:function(t,i){return this.x=t,this.y=i,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,i){return void 0!==i?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this},addScaledVector:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this},sub:function(t,i){return void 0!==i?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var i=this.x,n=this.y,t=t.elements;return this.x=t[0]*i+t[3]*n+t[6],this.y=t[1]*i+t[4]*n+t[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this},clampScalar:function(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this},clampLength:function(t,i){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(i,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){return Math.atan2(-this.y,-this.x)+Math.PI},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x,t=this.y-t.y;return i*i+t*t},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this},lerpVectors:function(t,i,n){return this.subVectors(i,t).multiplyScalar(n).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,i){return this.x=t[i=void 0===i?0:i],this.y=t[i+1],this},toArray:function(t,i){return(t=void 0===t?[]:t)[i=void 0===i?0:i]=this.x,t[i+1]=this.y,t},fromBufferAttribute:function(t,i,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(i),this.y=t.getY(i),this},rotateAround:function(t,i){var n=Math.cos(i),i=Math.sin(i),s=this.x-t.x,r=this.y-t.y;return this.x=s*n-r*i+t.x,this.y=s*i+r*n+t.y,this}}),((G.prototype=Object.create(Z.prototype)).constructor=G).prototype.isEllipseCurve=!0,G.prototype.getPoint=function(t,i){for(var i=i||new E,n=2*Math.PI,s=this.aEndAngle-this.aStartAngle,r=Math.abs(s)<Number.EPSILON;s<0;)s+=n;for(;n<s;)s-=n;s<Number.EPSILON&&(s=r?0:n),!0!==this.aClockwise||r||(s===n?s=-n:s-=n);var e,h,o,u,r=this.aStartAngle+t*s,t=this.aX+this.xRadius*Math.cos(r),r=this.aY+this.yRadius*Math.sin(r);return 0!==this.aRotation&&(e=Math.cos(this.aRotation),h=Math.sin(this.aRotation),t=(o=t-this.aX)*e-(u=r-this.aY)*h+this.aX,r=o*h+u*e+this.aY),i.set(t,r)},G.prototype.copy=function(t){return Z.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this};var q={FULL:0,DOTTED:2,DOT_DASH:4,CENTER:8,DASH:16,DOUBLE_DOT_DASH:32,TRI_DOT_DASH:64,FMARROW:128,ARROW:256},c=new w,z=new w,Q=new w,f=new w,W=new w,K=new w,J=new w;function $(t,i){this.origin=void 0!==t?t:new w,this.direction=void 0!==i?i:new w(0,0,-1)}function tt(){this.mask=1}function it(t,i,n,s){this.ray=new $(t,i),this.near=n||0,this.far=s||1/0,this.camera=null,this.layers=new tt,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function nt(t,i){return t.distance-i.distance}function st(t,i,n,s){if(t.layers.test(i.layers)&&t.raycast(i,n),!0===s)for(var r=t.children,e=0,h=r.length;e<h;e++)st(r[e],i,n,!0)}Object.assign($.prototype,{set:function(t,i){return this.origin.copy(t),this.direction.copy(i),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,i){return void 0===i&&(console.warn("THREE.Ray: .at() target is now required"),i=new w),i.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(t){return this.origin.copy(this.at(t,c)),this},closestPointToPoint:function(t,i){void 0===i&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),i=new w),i.subVectors(t,this.origin);t=i.dot(this.direction);return t<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(t).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(t){var i=c.subVectors(t,this.origin).dot(this.direction);return(i<0?this.origin:(c.copy(this.direction).multiplyScalar(i).add(this.origin),c)).distanceToSquared(t)},distanceSqToSegment:function(t,i,n,s){z.copy(t).add(i).multiplyScalar(.5),Q.copy(i).sub(t).normalize(),f.copy(this.origin).sub(z);var r,e,h,t=.5*t.distanceTo(i),i=-this.direction.dot(Q),o=f.dot(this.direction),u=-f.dot(Q),a=f.lengthSq(),c=Math.abs(1-i*i);return c=0<c?(e=i*o-u,h=t*c,0<=(r=i*u-o)?-h<=e?e<=h?(r*=c=1/c)*(r+i*(e*=c)+2*o)+e*(i*r+e+2*u)+a:(e=t,-(r=Math.max(0,-(i*e+o)))*r+e*(e+2*u)+a):(e=-t,-(r=Math.max(0,-(i*e+o)))*r+e*(e+2*u)+a):e<=-h?-(r=Math.max(0,-(-i*t+o)))*r+(e=0<r?-t:Math.min(Math.max(-t,-u),t))*(e+2*u)+a:e<=h?(r=0,(e=Math.min(Math.max(-t,-u),t))*(e+2*u)+a):-(r=Math.max(0,-(i*t+o)))*r+(e=0<r?t:Math.min(Math.max(-t,-u),t))*(e+2*u)+a):(e=0<i?-t:t,-(r=Math.max(0,-(i*e+o)))*r+e*(e+2*u)+a),n&&n.copy(this.direction).multiplyScalar(r).add(this.origin),s&&s.copy(Q).multiplyScalar(e).add(z),c},intersectSphere:function(t,i){c.subVectors(t.center,this.origin);var n=c.dot(this.direction),s=c.dot(c)-n*n,t=t.radius*t.radius;return t<s||(s=n+(t=Math.sqrt(t-s)),(n=n-t)<0&&s<0)?null:n<0?this.at(s,i):this.at(n,i)},intersectsSphere:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},distanceToPlane:function(t){var i=t.normal.dot(this.direction);return 0===i?0===t.distanceToPoint(this.origin)?0:null:0<=(t=-(this.origin.dot(t.normal)+t.constant)/i)?t:null},intersectPlane:function(t,i){t=this.distanceToPlane(t);return null===t?null:this.at(t,i)},intersectsPlane:function(t){var i=t.distanceToPoint(this.origin);return 0===i||t.normal.dot(this.direction)*i<0},intersectBox:function(t,i){var n,s,r,e=1/this.direction.x,h=1/this.direction.y,o=1/this.direction.z,u=this.origin,e=0<=e?(n=(t.min.x-u.x)*e,(t.max.x-u.x)*e):(n=(t.max.x-u.x)*e,(t.min.x-u.x)*e),h=0<=h?(r=(t.min.y-u.y)*h,(t.max.y-u.y)*h):(r=(t.max.y-u.y)*h,(t.min.y-u.y)*h);return h<n||e<r||((n<r||n!=n)&&(n=r),(h<e||e!=e)&&(e=h),(r=0<=o?(s=(t.min.z-u.z)*o,(t.max.z-u.z)*o):(s=(t.max.z-u.z)*o,(t.min.z-u.z)*o))<n)||e<s||((n<s||n!=n)&&(n=s),(e=r<e||e!=e?r:e)<0)?null:this.at(0<=n?n:e,i)},intersectsBox:function(t){return null!==this.intersectBox(t,c)},intersectTriangle:function(t,i,n,s,r){W.subVectors(i,t),K.subVectors(n,t),J.crossVectors(W,K);var e,i=this.direction.dot(J);if(0<i){if(s)return null;e=1}else{if(!(i<0))return null;e=-1,i=-i}f.subVectors(this.origin,t);n=e*this.direction.dot(K.crossVectors(f,K));return n<0||(s=e*this.direction.dot(W.cross(f)))<0||i<n+s||(t=-e*f.dot(J))<0?null:this.at(t/i,r)},applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}),Object.assign(tt.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},enableAll:function(){this.mask=-1},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},disableAll:function(){this.mask=0},test:function(t){return 0!=(this.mask&t.mask)}}),Object.assign(it.prototype,{set:function(t,i){this.ray.set(t,i)},setFromCamera:function(t,i){i&&i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i&&i.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,i,n){n=n||[];return st(t,this,n,i),n.sort(nt),n},intersectObjects:function(t,i,n){var s=n||[];if(!1===Array.isArray(t))console.warn("THREE.Raycaster.intersectObjects: objects is not an Array.");else{for(var r=0,e=t.length;r<e;r++)st(t[r],this,s,i);s.sort(nt)}return s}});var rt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},s={h:0,s:0,l:0},et={h:0,s:0,l:0};function l(t,i,n){return void 0===i&&void 0===n?this.set(t):this.setRGB(t,i,n)}function ht(t,i,n){return n<0&&(n+=1),1<n&&--n,n<1/6?t+6*(i-t)*n:n<.5?i:n<2/3?t+6*(i-t)*(2/3-n):t}function ot(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function ut(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}Object.assign(l.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,i,n){return this.r=t,this.g=i,this.b=n,this},setHSL:function(t,i,n){return t=d.euclideanModulo(t,1),i=d.clamp(i,0,1),n=d.clamp(n,0,1),0===i?this.r=this.g=this.b=n:(this.r=ht(i=2*n-(n=n<=.5?n*(1+i):n+i-n*i),n,t+1/3),this.g=ht(i,n,t),this.b=ht(i,n,t-1/3)),this},setStyle:function(i){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+i+" will be ignored.")}if(u=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(i)){var n,s,r,e,h=u[1],o=u[2];switch(h){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,t(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,t(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return s=parseFloat(n[1])/360,r=parseInt(n[2],10)/100,e=parseInt(n[3],10)/100,t(n[5]),this.setHSL(s,r,e)}}else if(u=/^\#([A-Fa-f0-9]+)$/.exec(i)){var h=u[1],u=h.length;if(3===u)return this.r=parseInt(h.charAt(0)+h.charAt(0),16)/255,this.g=parseInt(h.charAt(1)+h.charAt(1),16)/255,this.b=parseInt(h.charAt(2)+h.charAt(2),16)/255,this;if(6===u)return this.r=parseInt(h.charAt(0)+h.charAt(1),16)/255,this.g=parseInt(h.charAt(2)+h.charAt(3),16)/255,this.b=parseInt(h.charAt(4)+h.charAt(5),16)/255,this}return i&&0<i.length?this.setColorName(i):this},setColorName:function(t){var i=rt[t];return void 0!==i?this.setHex(i):console.warn("THREE.Color: Unknown color "+t),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,i){return void 0===i&&(i=2),this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this},copyLinearToGamma:function(t,i){i=0<(i=void 0===i?2:i)?1/i:1;return this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(t){return this.r=ot(t.r),this.g=ot(t.g),this.b=ot(t.b),this},copyLinearToSRGB:function(t){return this.r=ut(t.r),this.g=ut(t.g),this.b=ut(t.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var i,n=this.r,s=this.g,r=this.b,e=Math.max(n,s,r),h=Math.min(n,s,r),o=(h+e)/2;if(h===e)a=i=0;else{var u=e-h,a=o<=.5?u/(e+h):u/(2-e-h);switch(e){case n:i=(s-r)/u+(s<r?6:0);break;case s:i=(r-n)/u+2;break;case r:i=(n-s)/u+4}i/=6}return t.h=i,t.s=a,t.l=o,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,i,n){return this.getHSL(s),s.h+=t,s.s+=i,s.l+=n,this.setHSL(s.h,s.s,s.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,i){return this.r=t.r+i.r,this.g=t.g+i.g,this.b=t.b+i.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,i){return this.r+=(t.r-this.r)*i,this.g+=(t.g-this.g)*i,this.b+=(t.b-this.b)*i,this},lerpHSL:function(t,i){this.getHSL(s),t.getHSL(et);var t=d.lerp(s.h,et.h,i),n=d.lerp(s.s,et.s,i),i=d.lerp(s.l,et.l,i);return this.setHSL(t,n,i),this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,i){return this.r=t[i=void 0===i?0:i],this.g=t[i+1],this.b=t[i+2],this},toArray:function(t,i){return(t=void 0===t?[]:t)[i=void 0===i?0:i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t}}),l.NAMES=rt;var i=[new w,new w,new w,new w,new w,new w,new w,new w],at=new w,ct=new g,n=new w,v=new w,ft=new w,p=new w,m=new w,b=new w,lt=new w,vt=new w,dt=new w,M=new w;function g(t,i){this.min=void 0!==t?t:new w(1/0,1/0,1/0),this.max=void 0!==i?i:new w(-1/0,-1/0,-1/0)}function yt(t,i,n,s,r){for(var e=0,h=t.length-3;e<=h;e+=3){M.fromArray(t,e);var o=r.x*Math.abs(M.x)+r.y*Math.abs(M.y)+r.z*Math.abs(M.z),u=i.dot(M),a=n.dot(M),c=s.dot(M);if(Math.max(-Math.max(u,a,c),Math.min(u,a,c))>o)return!1}return!0}function pt(){}function mt(t,i,n,s){this.x=t||0,this.y=i||0,this.z=n||0,this.w=void 0!==s?s:1}Object.assign(g.prototype,{isBox3:!0,set:function(t,i){return this.min.copy(t),this.max.copy(i),this},setFromArray:function(t){for(var i=1/0,n=1/0,s=1/0,r=-1/0,e=-1/0,h=-1/0,o=0,u=t.length;o<u;o+=3){var a=t[o],c=t[o+1],f=t[o+2];a<i&&(i=a),c<n&&(n=c),f<s&&(s=f),r<a&&(r=a),e<c&&(e=c),h<f&&(h=f)}return this.min.set(i,n,s),this.max.set(r,e,h),this},setFromBufferAttribute:function(t){for(var i=1/0,n=1/0,s=1/0,r=-1/0,e=-1/0,h=-1/0,o=0,u=t.count;o<u;o++){var a=t.getX(o),c=t.getY(o),f=t.getZ(o);a<i&&(i=a),c<n&&(n=c),f<s&&(s=f),r<a&&(r=a),e<c&&(e=c),h<f&&(h=f)}return this.min.set(i,n,s),this.max.set(r,e,h),this},setFromPoints:function(t){this.makeEmpty();for(var i=0,n=t.length;i<n;i++)this.expandByPoint(t[i]);return this},setFromCenterAndSize:function(t,i){i=at.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this},setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new w),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new w),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(t){t.updateWorldMatrix(!1,!1);for(var i=t.geometry,n=(void 0!==i&&(null===i.boundingBox&&i.computeBoundingBox(),ct.copy(i.boundingBox),ct.applyMatrix4(t.matrixWorld),this.union(ct)),t.children),s=0,r=n.length;s<r;s++)this.expandByObject(n[s]);return this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,i){return void 0===i&&(console.warn("THREE.Box3: .getParameter() target is now required"),i=new w),i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(t){return this.clampPoint(t.center,at),at.distanceToSquared(t.center)<=t.radius*t.radius},intersectsPlane:function(t){var i,n=0<t.normal.x?(i=t.normal.x*this.min.x,t.normal.x*this.max.x):(i=t.normal.x*this.max.x,t.normal.x*this.min.x);return 0<t.normal.y?(i+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(i+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),0<t.normal.z?(i+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(i+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),i<=-t.constant&&n>=-t.constant},intersectsTriangle:function(t){return!this.isEmpty()&&(this.getCenter(lt),vt.subVectors(this.max,lt),n.subVectors(t.a,lt),v.subVectors(t.b,lt),ft.subVectors(t.c,lt),p.subVectors(v,n),m.subVectors(ft,v),b.subVectors(n,ft),!!yt([0,-p.z,p.y,0,-m.z,m.y,0,-b.z,b.y,p.z,0,-p.x,m.z,0,-m.x,b.z,0,-b.x,-p.y,p.x,0,-m.y,m.x,0,-b.y,b.x,0],n,v,ft,vt))&&!!yt([1,0,0,0,1,0,0,0,1],n,v,ft,vt)&&(dt.crossVectors(p,m),yt([dt.x,dt.y,dt.z],n,v,ft,vt))},clampPoint:function(t,i){return void 0===i&&(console.warn("THREE.Box3: .clampPoint() target is now required"),i=new w),i.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return at.copy(t).clamp(this.min,this.max).sub(t).length()},getBoundingSphere:function(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(at).length(),t},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(t){return this.isEmpty()||(i[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),i[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),i[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),i[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),i[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),i[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),i[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),i[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(i)),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),Object.assign(pt.prototype,{addEventListener:function(t,i){void 0===this.j&&(this.j={});var n=this.j;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(i)&&n[t].push(i)},hasEventListener:function(t,i){var n;return void 0!==this.j&&void 0!==(n=this.j)[t]&&-1!==n[t].indexOf(i)},removeEventListener:function(t,i){var n;void 0!==this.j&&void 0!==(t=this.j[t])&&-1!==(n=t.indexOf(i))&&t.splice(n,1)},dispatchEvent:function(t){if(void 0!==this.j){var i=this.j[t.type];if(void 0!==i){t.target=this;for(var n=i.slice(0),s=0,r=n.length;s<r;s++)n[s].call(this,t)}}}}),Object.defineProperties(mt.prototype,{width:{get:function(){return this.z},set:function(t){this.z=t}},height:{get:function(){return this.w},set:function(t){this.w=t}}}),Object.assign(mt.prototype,{isVector4:!0,set:function(t,i,n,s){return this.x=t,this.y=i,this.z=n,this.w=s,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,i){return void 0!==i?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this},addScaledVector:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this},sub:function(t,i){return void 0!==i?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var i=this.x,n=this.y,s=this.z,r=this.w,t=t.elements;return this.x=t[0]*i+t[4]*n+t[8]*s+t[12]*r,this.y=t[1]*i+t[5]*n+t[9]*s+t[13]*r,this.z=t[2]*i+t[6]*n+t[10]*s+t[14]*r,this.w=t[3]*i+t[7]*n+t[11]*s+t[15]*r,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var i=Math.sqrt(1-t.w*t.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/i,this.y=t.y/i,this.z=t.z/i),this},setAxisAngleFromRotationMatrix:function(t){var i,n,s,r,e,h,o,u,a,c,t=t.elements,f=t[0],l=t[4],v=t[8],d=t[1],y=t[5],p=t[9],m=t[2],b=t[6],t=t[10];return Math.abs(l-d)<.01&&Math.abs(v-m)<.01&&Math.abs(p-b)<.01?Math.abs(l+d)<.1&&Math.abs(v+m)<.1&&Math.abs(p+b)<.1&&Math.abs(f+y+t-3)<.1?this.set(1,0,0,0):(r=Math.PI,h=(t+1)/2,o=(l+d)/4,u=(v+m)/4,a=(p+b)/4,(e=(y+1)/2)<(c=(f+1)/2)&&h<c?s=c<.01?(i=0,n=.707106781):(n=o/(i=Math.sqrt(c)),u/i):h<e?s=e<.01?(n=0,i=.707106781):(i=o/(n=Math.sqrt(e)),a/n):h<.01?(n=i=.707106781,s=0):(i=u/(s=Math.sqrt(h)),n=a/s),this.set(i,n,s,r)):(c=Math.sqrt((b-p)*(b-p)+(v-m)*(v-m)+(d-l)*(d-l)),Math.abs(c)<.001&&(c=1),this.x=(b-p)/c,this.y=(v-m)/c,this.z=(d-l)/c,this.w=Math.acos((f+y+t-1)/2)),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this.w=Math.max(t.w,Math.min(i.w,this.w)),this},clampScalar:function(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this.w=Math.max(t,Math.min(i,this.w)),this},clampLength:function(t,i){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(i,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this},lerpVectors:function(t,i,n){return this.subVectors(i,t).multiplyScalar(n).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,i){return this.x=t[i=void 0===i?0:i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this},toArray:function(t,i){return(t=void 0===t?[]:t)[i=void 0===i?0:i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t},fromBufferAttribute:function(t,i,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this.w=t.getW(i),this}});var A=new w;function S(t,i,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=i,this.count=void 0!==t?t.length/i:0,this.normalized=!0===n,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}function bt(t,i,n){S.call(this,new Int8Array(t),i,n)}function Mt(t,i,n){S.call(this,new Uint8Array(t),i,n)}function wt(t,i,n){S.call(this,new Uint8ClampedArray(t),i,n)}function gt(t,i,n){S.call(this,new Int16Array(t),i,n)}function At(t,i,n){S.call(this,new Uint16Array(t),i,n)}function Et(t,i,n){S.call(this,new Int32Array(t),i,n)}function St(t,i,n){S.call(this,new Uint32Array(t),i,n)}function R(t,i,n){S.call(this,new Float32Array(t),i,n)}function Rt(t,i,n){S.call(this,new Float64Array(t),i,n)}Object.defineProperty(S.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(S.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,i,n){t*=this.itemSize,n*=i.itemSize;for(var s=0,r=this.itemSize;s<r;s++)this.array[t+s]=i.array[n+s];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var i=this.array,n=0,s=0,r=t.length;s<r;s++){var e=t[s];void 0===e&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",s),e=new l),i[n++]=e.r,i[n++]=e.g,i[n++]=e.b}return this},copyVector2sArray:function(t){for(var i=this.array,n=0,s=0,r=t.length;s<r;s++){var e=t[s];void 0===e&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",s),e=new E),i[n++]=e.x,i[n++]=e.y}return this},copyVector3sArray:function(t){for(var i=this.array,n=0,s=0,r=t.length;s<r;s++){var e=t[s];void 0===e&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",s),e=new w),i[n++]=e.x,i[n++]=e.y,i[n++]=e.z}return this},copyVector4sArray:function(t){for(var i=this.array,n=0,s=0,r=t.length;s<r;s++){var e=t[s];void 0===e&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",s),e=new mt),i[n++]=e.x,i[n++]=e.y,i[n++]=e.z,i[n++]=e.w}return this},applyMatrix3:function(t){for(var i=0,n=this.count;i<n;i++)A.x=this.getX(i),A.y=this.getY(i),A.z=this.getZ(i),A.applyMatrix3(t),this.setXYZ(i,A.x,A.y,A.z);return this},applyMatrix4:function(t){for(var i=0,n=this.count;i<n;i++)A.x=this.getX(i),A.y=this.getY(i),A.z=this.getZ(i),A.applyMatrix4(t),this.setXYZ(i,A.x,A.y,A.z);return this},applyNormalMatrix:function(t){for(var i=0,n=this.count;i<n;i++)A.x=this.getX(i),A.y=this.getY(i),A.z=this.getZ(i),A.applyNormalMatrix(t),this.setXYZ(i,A.x,A.y,A.z);return this},transformDirection:function(t){for(var i=0,n=this.count;i<n;i++)A.x=this.getX(i),A.y=this.getY(i),A.z=this.getZ(i),A.transformDirection(t),this.setXYZ(i,A.x,A.y,A.z);return this},set:function(t,i){return this.array.set(t,i=void 0===i?0:i),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,i){return this.array[t*this.itemSize]=i,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,i){return this.array[t*this.itemSize+1]=i,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,i){return this.array[t*this.itemSize+2]=i,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,i){return this.array[t*this.itemSize+3]=i,this},setXY:function(t,i,n){return t*=this.itemSize,this.array[t+0]=i,this.array[t+1]=n,this},setXYZ:function(t,i,n,s){return t*=this.itemSize,this.array[t+0]=i,this.array[t+1]=n,this.array[t+2]=s,this},setXYZW:function(t,i,n,s,r){return t*=this.itemSize,this.array[t+0]=i,this.array[t+1]=n,this.array[t+2]=s,this.array[t+3]=r,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),(bt.prototype=Object.create(S.prototype)).constructor=bt,(Mt.prototype=Object.create(S.prototype)).constructor=Mt,(wt.prototype=Object.create(S.prototype)).constructor=wt,(gt.prototype=Object.create(S.prototype)).constructor=gt,At.prototype=Object.create(S.prototype),At.prototype.constructor=At,(Et.prototype=Object.create(S.prototype)).constructor=Et,St.prototype=Object.create(S.prototype),St.prototype.constructor=St,(R.prototype=Object.create(S.prototype)).constructor=R,(Rt.prototype=Object.create(S.prototype)).constructor=Rt;var jt=new g;function xt(t,i){this.center=void 0!==t?t:new w,this.radius=void 0!==i?i:0}function Ot(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}Object.assign(xt.prototype,{set:function(t,i){return this.center.copy(t),this.radius=i,this},setFromPoints:function(t,i){for(var n=this.center,s=(void 0!==i?n.copy(i):jt.setFromPoints(t).getCenter(n),0),r=0,e=t.length;r<e;r++)s=Math.max(s,n.distanceToSquared(t[r]));return this.radius=Math.sqrt(s),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var i=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=i*i},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,i){var n=this.center.distanceToSquared(t);return void 0===i&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),i=new w),i.copy(t),n>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i},getBoundingBox:function(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new g),t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}),Object.assign(Ot.prototype,{computeGroups:function(t){for(var i,n=[],s=void 0,r=t.faces,e=0;e<r.length;e++){var h=r[e];h.materialIndex!==s&&(s=h.materialIndex,void 0!==i&&(i.count=3*e-i.start,n.push(i)),i={start:3*e,materialIndex:s})}void 0!==i&&(i.count=3*e-i.start,n.push(i)),this.groups=n},fromGeometry:function(t){var i=t.faces,n=t.vertices,s=t.faceVertexUvs,r=s[0]&&0<s[0].length,e=s[1]&&0<s[1].length,h=t.morphTargets,o=h.length;if(0<o){for(var u=[],a=0;a<o;a++)u[a]={name:h[a].name,data:[]};this.morphTargets.position=u}var c=t.morphNormals,f=c.length;if(0<f){for(var l=[],a=0;a<f;a++)l[a]={name:c[a].name,data:[]};this.morphTargets.normal=l}var v=t.skinIndices,d=t.skinWeights,y=v.length===n.length,p=d.length===n.length;0<n.length&&0===i.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(a=0;a<i.length;a++){var m,b=i[a],M=(this.vertices.push(n[b.a],n[b.b],n[b.c]),b.vertexNormals),M=(3===M.length?this.normals.push(M[0],M[1],M[2]):(M=b.normal,this.normals.push(M,M,M)),b.vertexColors);3===M.length?this.colors.push(M[0],M[1],M[2]):(M=b.color,this.colors.push(M,M,M)),!0===r&&(void 0!==(m=s[0][a])?this.uvs.push(m[0],m[1],m[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",a),this.uvs.push(new E,new E,new E))),!0===e&&(void 0!==(m=s[1][a])?this.uvs2.push(m[0],m[1],m[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",a),this.uvs2.push(new E,new E,new E)));for(var w=0;w<o;w++){var g=h[w].vertices;u[w].data.push(g[b.a],g[b.b],g[b.c])}for(w=0;w<f;w++){var A=c[w].vertexNormals[a];l[w].data.push(A.a,A.b,A.c)}y&&this.skinIndices.push(v[b.a],v[b.b],v[b.c]),p&&this.skinWeights.push(d[b.a],d[b.b],d[b.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}});var Tt=new y,kt=new e;function Bt(t,i,n,s){this.u=t||0,this.v=i||0,this.M=n||0,this.O=s||Bt.DefaultOrder}function It(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Bt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Bt.DefaultOrder="XYZ",Object.defineProperties(Bt.prototype,{x:{get:function(){return this.u},set:function(t){this.u=t,this.S()}},y:{get:function(){return this.v},set:function(t){this.v=t,this.S()}},z:{get:function(){return this.M},set:function(t){this.M=t,this.S()}},order:{get:function(){return this.O},set:function(t){this.O=t,this.S()}}}),Object.assign(Bt.prototype,{isEuler:!0,set:function(t,i,n,s){return this.u=t,this.v=i,this.M=n,this.O=s||this.O,this.S(),this},clone:function(){return new this.constructor(this.u,this.v,this.M,this.O)},copy:function(t){return this.u=t.u,this.v=t.v,this.M=t.M,this.O=t.O,this.S(),this},setFromRotationMatrix:function(t,i,n){var s=d.clamp,t=t.elements,r=t[0],e=t[4],h=t[8],o=t[1],u=t[5],a=t[9],c=t[2],f=t[6],t=t[10];return"XYZ"===(i=i||this.O)?(this.v=Math.asin(s(h,-1,1)),Math.abs(h)<.9999999?(this.u=Math.atan2(-a,t),this.M=Math.atan2(-e,r)):(this.u=Math.atan2(f,u),this.M=0)):"YXZ"===i?(this.u=Math.asin(-s(a,-1,1)),Math.abs(a)<.9999999?(this.v=Math.atan2(h,t),this.M=Math.atan2(o,u)):(this.v=Math.atan2(-c,r),this.M=0)):"ZXY"===i?(this.u=Math.asin(s(f,-1,1)),Math.abs(f)<.9999999?(this.v=Math.atan2(-c,t),this.M=Math.atan2(-e,u)):(this.v=0,this.M=Math.atan2(o,r))):"ZYX"===i?(this.v=Math.asin(-s(c,-1,1)),Math.abs(c)<.9999999?(this.u=Math.atan2(f,t),this.M=Math.atan2(o,r)):(this.u=0,this.M=Math.atan2(-e,u))):"YZX"===i?(this.M=Math.asin(s(o,-1,1)),Math.abs(o)<.9999999?(this.u=Math.atan2(-a,u),this.v=Math.atan2(-c,r)):(this.u=0,this.v=Math.atan2(h,t))):"XZY"===i?(this.M=Math.asin(-s(e,-1,1)),Math.abs(e)<.9999999?(this.u=Math.atan2(f,u),this.v=Math.atan2(h,r)):(this.u=Math.atan2(-a,t),this.v=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+i),this.O=i,!1!==n&&this.S(),this},setFromQuaternion:function(t,i,n){return Tt.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Tt,i,n)},setFromVector3:function(t,i){return this.set(t.x,t.y,t.z,i||this.O)},reorder:function(t){return kt.setFromEuler(this),this.setFromQuaternion(kt,t)},equals:function(t){return t.u===this.u&&t.v===this.v&&t.M===this.M&&t.O===this.O},fromArray:function(t){return this.u=t[0],this.v=t[1],this.M=t[2],void 0!==t[3]&&(this.O=t[3]),this.S(),this},toArray:function(t,i){return(t=void 0===t?[]:t)[i=void 0===i?0:i]=this.u,t[i+1]=this.v,t[i+2]=this.M,t[i+3]=this.O,t},toVector3:function(t){return t?t.set(this.u,this.v,this.M):new w(this.u,this.v,this.M)},R:function(t){return this.S=t,this},S:function(){}}),Object.assign(It.prototype,{isMatrix3:!0,set:function(t,i,n,s,r,e,h,o,u){var a=this.elements;return a[0]=t,a[1]=s,a[2]=h,a[3]=i,a[4]=r,a[5]=o,a[6]=n,a[7]=e,a[8]=u,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var i=this.elements,t=t.elements;return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],this},extractBasis:function(t,i,n){return t.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this},setFromMatrix4:function(t){t=t.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,i){var t=t.elements,i=i.elements,n=this.elements,s=t[0],r=t[3],e=t[6],h=t[1],o=t[4],u=t[7],a=t[2],c=t[5],t=t[8],f=i[0],l=i[3],v=i[6],d=i[1],y=i[4],p=i[7],m=i[2],b=i[5],i=i[8];return n[0]=s*f+r*d+e*m,n[3]=s*l+r*y+e*b,n[6]=s*v+r*p+e*i,n[1]=h*f+o*d+u*m,n[4]=h*l+o*y+u*b,n[7]=h*v+o*p+u*i,n[2]=a*f+c*d+t*m,n[5]=a*l+c*y+t*b,n[8]=a*v+c*p+t*i,this},multiplyScalar:function(t){var i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this},determinant:function(){var t=this.elements,i=t[0],n=t[1],s=t[2],r=t[3],e=t[4],h=t[5],o=t[6],u=t[7],t=t[8];return i*e*t-i*h*u-n*r*t+n*h*o+s*r*u-s*e*o},getInverse:function(t,i){void 0!==i&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");var i=t.elements,t=this.elements,n=i[0],s=i[1],r=i[2],e=i[3],h=i[4],o=i[5],u=i[6],a=i[7],i=i[8],c=i*h-o*a,f=o*u-i*e,l=a*e-h*u,v=n*c+s*f+r*l;return 0==v?this.set(0,0,0,0,0,0,0,0,0):(t[0]=c*(c=1/v),t[1]=(r*a-i*s)*c,t[2]=(o*s-r*h)*c,t[3]=f*c,t[4]=(i*n-r*u)*c,t[5]=(r*e-o*n)*c,t[6]=l*c,t[7]=(s*u-a*n)*c,t[8]=(h*n-s*e)*c,this)},transpose:function(){var t=this.elements,i=t[1];return t[1]=t[3],t[3]=i,i=t[2],t[2]=t[6],t[6]=i,i=t[5],t[5]=t[7],t[7]=i,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var i=this.elements;return t[0]=i[0],t[1]=i[3],t[2]=i[6],t[3]=i[1],t[4]=i[4],t[5]=i[7],t[6]=i[2],t[7]=i[5],t[8]=i[8],this},setUvTransform:function(t,i,n,s,r,e,h){var o=Math.cos(r),r=Math.sin(r);this.set(n*o,n*r,-n*(o*e+r*h)+e+t,-s*r,s*o,-s*(-r*e+o*h)+h+i,0,0,1)},scale:function(t,i){var n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=i,n[4]*=i,n[7]*=i,this},rotate:function(t){var i=Math.cos(t),t=Math.sin(t),n=this.elements,s=n[0],r=n[3],e=n[6],h=n[1],o=n[4],u=n[7];return n[0]=i*s+t*h,n[3]=i*r+t*o,n[6]=i*e+t*u,n[1]=-t*s+i*h,n[4]=-t*r+i*o,n[7]=-t*e+i*u,this},translate:function(t,i){var n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=i*n[2],n[4]+=i*n[5],n[7]+=i*n[8],this},equals:function(t){for(var i=this.elements,n=t.elements,s=0;s<9;s++)if(i[s]!==n[s])return!1;return!0},fromArray:function(t,i){void 0===i&&(i=0);for(var n=0;n<9;n++)this.elements[n]=t[n+i];return this},toArray:function(t,i){var n=this.elements;return(t=void 0===t?[]:t)[i=void 0===i?0:i]=n[0],t[i+1]=n[1],t[i+2]=n[2],t[i+3]=n[3],t[i+4]=n[4],t[i+5]=n[5],t[i+6]=n[6],t[i+7]=n[7],t[i+8]=n[8],t}});var Ct=0,Pt=new w,Vt=new e,j=new y,_t=new w,Ft=new w,Lt=new w,Dt=new e,Ht=new w(1,0,0),Yt=new w(0,1,0),Nt=new w(0,0,1),Xt={type:"added"},Ut={type:"removed"};function x(){Object.defineProperty(this,"id",{value:Ct++}),this.uuid=d.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=x.DefaultUp.clone();var t=new w,i=new Bt,n=new e,s=new w(1,1,1);i.R(function(){n.setFromEuler(i,!1)}),n.R(function(){i.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new y},normalMatrix:{value:new It}}),this.matrix=new y,this.matrixWorld=new y,this.matrixAutoUpdate=x.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new tt,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}x.DefaultUp=new w(0,1,0),x.DefaultMatrixAutoUpdate=!0,x.prototype=Object.assign(Object.create(pt.prototype),{constructor:x,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,i){this.quaternion.setFromAxisAngle(t,i)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,i){return Vt.setFromAxisAngle(t,i),this.quaternion.multiply(Vt),this},rotateOnWorldAxis:function(t,i){return Vt.setFromAxisAngle(t,i),this.quaternion.premultiply(Vt),this},rotateX:function(t){return this.rotateOnAxis(Ht,t)},rotateY:function(t){return this.rotateOnAxis(Yt,t)},rotateZ:function(t){return this.rotateOnAxis(Nt,t)},translateOnAxis:function(t,i){return Pt.copy(t).applyQuaternion(this.quaternion),this.position.add(Pt.multiplyScalar(i)),this},translateX:function(t){return this.translateOnAxis(Ht,t)},translateY:function(t){return this.translateOnAxis(Yt,t)},translateZ:function(t){return this.translateOnAxis(Nt,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(j.getInverse(this.matrixWorld))},lookAt:function(t,i,n){t.isVector3?_t.copy(t):_t.set(t,i,n);t=this.parent;this.updateWorldMatrix(!0,!1),Ft.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?j.lookAt(Ft,_t,this.up):j.lookAt(_t,Ft,this.up),this.quaternion.setFromRotationMatrix(j),t&&(j.extractRotation(t.matrixWorld),Vt.setFromRotationMatrix(j),this.quaternion.premultiply(Vt.inverse()))},add:function(t){if(1<arguments.length)for(var i=0;i<arguments.length;i++)this.add(arguments[i]);else t===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",t):t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),(t.parent=this).children.push(t),t.dispatchEvent(Xt)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t);return this},remove:function(t){if(1<arguments.length)for(var i=0;i<arguments.length;i++)this.remove(arguments[i]);else{var n=this.children.indexOf(t);-1!==n&&(t.parent=null,this.children.splice(n,1),t.dispatchEvent(Ut))}return this},attach:function(t){return this.updateWorldMatrix(!0,!1),j.getInverse(this.matrixWorld),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),j.multiply(t.parent.matrixWorld)),t.applyMatrix4(j),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,i){if(this[t]===i)return this;for(var n=0,s=this.children.length;n<s;n++){var r=this.children[n].getObjectByProperty(t,i);if(void 0!==r)return r}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new w),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new e),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Ft,t,Lt),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new w),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Ft,Dt,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new w),this.updateMatrixWorld(!0);var i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var i=this.children,n=0,s=i.length;n<s;n++)i[n].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var i=this.children,n=0,s=i.length;n<s;n++)i[n].traverseVisible(t)}},traverseAncestors:function(t){var i=this.parent;null!==i&&(t(i),i.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t=!(this.matrixWorldNeedsUpdate=!1));for(var i=this.children,n=0,s=i.length;n<s;n++)i[n].updateMatrixWorld(t)},updateWorldMatrix:function(t,i){var n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===i)for(var s=this.children,r=0,e=s.length;r<e;r++)s[r].updateWorldMatrix(!1,!0)},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,i){if(void 0===i&&(i=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===i)for(var n=0;n<t.children.length;n++){var s=t.children[n];this.add(s.clone())}return this}});var Zt=1,O=new y,Gt=new x,qt=new w,T=new g,zt=new g,k=new w;function Qt(){Object.defineProperty(this,"id",{value:Zt+=2}),this.uuid=d.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}Qt.prototype=Object.assign(Object.create(pt.prototype),{constructor:Qt,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(65535<function(t){if(0===t.length)return-1/0;for(var i=t[0],n=1,s=t.length;n<s;++n)t[n]>i&&(i=t[n]);return i}(t)?St:At)(t,1):this.index=t},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,i){return this.attributes[t]=i,this},deleteAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,i,n){this.groups.push({start:t,count:i,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,i){this.drawRange.start=t,this.drawRange.count=i},applyMatrix4:function(t){var i=this.attributes.position,i=(void 0!==i&&(i.applyMatrix4(t),i.needsUpdate=!0),this.attributes.normal),n=(void 0!==i&&(n=(new It).getNormalMatrix(t),i.applyNormalMatrix(n),i.needsUpdate=!0),this.attributes.tangent);return void 0!==n&&(n.transformDirection(t),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return O.makeRotationX(t),this.applyMatrix4(O),this},rotateY:function(t){return O.makeRotationY(t),this.applyMatrix4(O),this},rotateZ:function(t){return O.makeRotationZ(t),this.applyMatrix4(O),this},translate:function(t,i,n){return O.makeTranslation(t,i,n),this.applyMatrix4(O),this},scale:function(t,i,n){return O.makeScale(t,i,n),this.applyMatrix4(O),this},lookAt:function(t){return Gt.lookAt(t),Gt.updateMatrix(),this.applyMatrix4(Gt.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(qt).negate(),this.translate(qt.x,qt.y,qt.z),this},setFromObject:function(t){var i,n,s=t.geometry;return t.isPoints||t.isLine?(n=new R(3*s.vertices.length,3),i=new R(3*s.colors.length,3),this.setAttribute("position",n.copyVector3sArray(s.vertices)),this.setAttribute("color",i.copyColorsArray(s.colors)),s.lineDistances&&s.lineDistances.length===s.vertices.length&&(n=new R(s.lineDistances.length,1),this.setAttribute("lineDistance",n.copyArray(s.lineDistances))),null!==s.boundingSphere&&(this.boundingSphere=s.boundingSphere.clone()),null!==s.boundingBox&&(this.boundingBox=s.boundingBox.clone())):t.isMesh&&s&&s.isGeometry&&this.fromGeometry(s),this},setFromPoints:function(t){for(var i=[],n=0,s=t.length;n<s;n++){var r=t[n];i.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new R(i,3)),this},updateFromObject:function(t){var i,n=t.geometry;if(t.isMesh){var s=n.T;if(!0===n.elementsNeedUpdate&&(s=void 0,n.elementsNeedUpdate=!1),void 0===s)return this.fromGeometry(n);s.verticesNeedUpdate=n.verticesNeedUpdate,s.normalsNeedUpdate=n.normalsNeedUpdate,s.colorsNeedUpdate=n.colorsNeedUpdate,s.uvsNeedUpdate=n.uvsNeedUpdate,s.groupsNeedUpdate=n.groupsNeedUpdate,n.verticesNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.groupsNeedUpdate=!1,n=s}return!0===n.verticesNeedUpdate&&(void 0!==(i=this.attributes.position)&&(i.copyVector3sArray(n.vertices),i.needsUpdate=!0),n.verticesNeedUpdate=!1),!0===n.normalsNeedUpdate&&(void 0!==(i=this.attributes.normal)&&(i.copyVector3sArray(n.normals),i.needsUpdate=!0),n.normalsNeedUpdate=!1),!0===n.colorsNeedUpdate&&(void 0!==(i=this.attributes.color)&&(i.copyColorsArray(n.colors),i.needsUpdate=!0),n.colorsNeedUpdate=!1),n.uvsNeedUpdate&&(void 0!==(i=this.attributes.uv)&&(i.copyVector2sArray(n.uvs),i.needsUpdate=!0),n.uvsNeedUpdate=!1),n.lineDistancesNeedUpdate&&(void 0!==(i=this.attributes.lineDistance)&&(i.copyArray(n.lineDistances),i.needsUpdate=!0),n.lineDistancesNeedUpdate=!1),n.groupsNeedUpdate&&(n.computeGroups(t.geometry),this.groups=n.groups,n.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.T=(new Ot).fromGeometry(t),this.fromDirectGeometry(t.T)},fromDirectGeometry:function(t){var i,n=new Float32Array(3*t.vertices.length);for(i in this.setAttribute("position",new S(n,3).copyVector3sArray(t.vertices)),0<t.normals.length&&(n=new Float32Array(3*t.normals.length),this.setAttribute("normal",new S(n,3).copyVector3sArray(t.normals))),0<t.colors.length&&(n=new Float32Array(3*t.colors.length),this.setAttribute("color",new S(n,3).copyColorsArray(t.colors))),0<t.uvs.length&&(n=new Float32Array(2*t.uvs.length),this.setAttribute("uv",new S(n,2).copyVector2sArray(t.uvs))),0<t.uvs2.length&&(n=new Float32Array(2*t.uvs2.length),this.setAttribute("uv2",new S(n,2).copyVector2sArray(t.uvs2))),this.groups=t.groups,t.morphTargets){for(var s=[],r=t.morphTargets[i],e=0,h=r.length;e<h;e++){var o=r[e],u=new R(3*o.data.length,3);u.name=o.name,s.push(u.copyVector3sArray(o.data))}this.morphAttributes[i]=s}return 0<t.skinIndices.length&&(n=new R(4*t.skinIndices.length,4),this.setAttribute("skinIndex",n.copyVector4sArray(t.skinIndices))),0<t.skinWeights.length&&(n=new R(4*t.skinWeights.length,4),this.setAttribute("skinWeight",n.copyVector4sArray(t.skinWeights))),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new g);var t=this.attributes.position,i=this.morphAttributes.position;if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),i)for(var n=0,s=i.length;n<s;n++){var r=i[n];T.setFromBufferAttribute(r),this.morphTargetsRelative?(k.addVectors(this.boundingBox.min,T.min),this.boundingBox.expandByPoint(k),k.addVectors(this.boundingBox.max,T.max),this.boundingBox.expandByPoint(k)):(this.boundingBox.expandByPoint(T.min),this.boundingBox.expandByPoint(T.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new xt);var t=this.attributes.position,i=this.morphAttributes.position;if(t){var n=this.boundingSphere.center;if(T.setFromBufferAttribute(t),i)for(var s=0,r=i.length;s<r;s++){var e=i[s];zt.setFromBufferAttribute(e),this.morphTargetsRelative?(k.addVectors(T.min,zt.min),T.expandByPoint(k),k.addVectors(T.max,zt.max),T.expandByPoint(k)):(T.expandByPoint(zt.min),T.expandByPoint(zt.max))}T.getCenter(n);for(var h=0,s=0,r=t.count;s<r;s++)k.fromBufferAttribute(t,s),h=Math.max(h,n.distanceToSquared(k));if(i)for(s=0,r=i.length;s<r;s++)for(var e=i[s],o=this.morphTargetsRelative,u=0,a=e.count;u<a;u++)k.fromBufferAttribute(e,u),o&&(qt.fromBufferAttribute(t,u),k.add(qt)),h=Math.max(h,n.distanceToSquared(k));this.boundingSphere.radius=Math.sqrt(h),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,i=this.attributes;if(i.position){var n=i.position.array;if(void 0===i.normal)this.setAttribute("normal",new S(new Float32Array(n.length),3));else for(var s=i.normal.array,r=0,e=s.length;r<e;r++)s[r]=0;var h,o,u,a=i.normal.array,c=new w,f=new w,l=new w,v=new w,d=new w;if(t)for(var y=t.array,r=0,e=t.count;r<e;r+=3)h=3*y[r+0],o=3*y[r+1],u=3*y[r+2],c.fromArray(n,h),f.fromArray(n,o),l.fromArray(n,u),v.subVectors(l,f),d.subVectors(c,f),v.cross(d),a[h]+=v.x,a[1+h]+=v.y,a[2+h]+=v.z,a[o]+=v.x,a[1+o]+=v.y,a[2+o]+=v.z,a[u]+=v.x,a[1+u]+=v.y,a[2+u]+=v.z;else for(r=0,e=n.length;r<e;r+=9)c.fromArray(n,r),f.fromArray(n,r+3),l.fromArray(n,r+6),v.subVectors(l,f),d.subVectors(c,f),v.cross(d),a[r]=v.x,a[r+1]=v.y,a[r+2]=v.z,a[r+3]=v.x,a[r+4]=v.y,a[r+5]=v.z,a[r+6]=v.x,a[r+7]=v.y,a[r+8]=v.z;this.normalizeNormals(),i.normal.needsUpdate=!0}},normalizeNormals:function(){for(var t=this.attributes.normal,i=0,n=t.count;i<n;i++)k.x=t.getX(i),k.y=t.getY(i),k.z=t.getZ(i),k.normalize(),t.setXYZ(i,k.x,k.y,k.z)},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Wt=0;function Kt(){Object.defineProperty(this,"id",{value:Wt++}),this.uuid=d.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function B(t){Kt.call(this),this.type="LineBasicMaterial",this.color=new l(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}Kt.prototype=Object.assign(Object.create(pt.prototype),{constructor:Kt,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var i in t){var n,s=t[i];void 0===s?console.warn("THREE.Material: '"+i+"' parameter is undefined."):"shading"===i?(console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===s):void 0===(n=this[i])?console.warn("THREE."+this.type+": '"+i+"' is not a property of this material."):n&&n.isColor?n.set(s):n&&n.isVector3&&s&&s.isVector3?n.copy(s):this[i]=s}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;var i=t.clippingPlanes,n=null;if(null!==i)for(var s=i.length,n=new Array(s),r=0;r!==s;++r)n[r]=i[r].clone();return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Kt.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),((B.prototype=Object.create(Kt.prototype)).constructor=B).prototype.isLineBasicMaterial=!0,B.prototype.copy=function(t){return Kt.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this};var Jt=new w,$t=new w,ti=new y,ii=new $,ni=new xt;function si(t,i,n){1===n&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),x.call(this),this.type="Line",this.geometry=void 0!==t?t:new Qt,this.material=void 0!==i?i:new B}function ri(t){return(ri="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ei(t,i){for(var n=0;n<i.length;n++){var s=i[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,function(t){t=function(t,i){if("object"!==ri(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===i?String:Number)(t);n=n.call(t,i||"default");if("object"!==ri(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"===ri(t)?t:String(t)}(s.key),s)}}function hi(t,i,n){return i&&ei(t.prototype,i),n&&ei(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}si.prototype=Object.assign(Object.create(x.prototype),{constructor:si,isLine:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var i=t.attributes.position,n=[0],s=1,r=i.count;s<r;s++)Jt.fromBufferAttribute(i,s-1),$t.fromBufferAttribute(i,s),n[s]=n[s-1],n[s]+=Jt.distanceTo($t);t.setAttribute("lineDistance",new R(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){var e=t.vertices;(n=t.lineDistances)[0]=0;for(s=1,r=e.length;s<r;s++)n[s]=n[s-1],n[s]+=e[s-1].distanceTo(e[s])}return this},raycast:function(t,i){var n=this.geometry,s=this.matrixWorld,r=t.params.Line.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),ni.copy(n.boundingSphere),ni.applyMatrix4(s),ni.radius+=r,!1!==t.ray.intersectsSphere(ni)){ti.getInverse(s),ii.copy(t.ray).applyMatrix4(ti);var s=r/((this.scale.x+this.scale.y+this.scale.z)/3),e=s*s,h=new w,o=new w,u=new w,a=new w,c=this&&this.isLineSegments?2:1;if(n.isBufferGeometry){var r=n.index,f=n.attributes.position.array;if(null!==r)for(var l=r.array,v=0,d=l.length-1;v<d;v+=c){var y=l[v],p=l[v+1];h.fromArray(f,3*y),o.fromArray(f,3*p),e<ii.distanceSqToSegment(h,o,a,u)||(a.applyMatrix4(this.matrixWorld),(m=t.ray.origin.distanceTo(a))<t.near)||m>t.far||i.push({distance:m,point:u.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}else for(v=0,d=f.length/3-1;v<d;v+=c)h.fromArray(f,3*v),o.fromArray(f,3*v+3),e<ii.distanceSqToSegment(h,o,a,u)||(a.applyMatrix4(this.matrixWorld),(m=t.ray.origin.distanceTo(a))<t.near)||m>t.far||i.push({distance:m,point:u.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}else if(n.isGeometry)for(var m,b=n.vertices,M=b.length,v=0;v<M-1;v+=c)e<ii.distanceSqToSegment(b[v],b[v+1],a,u)||(a.applyMatrix4(this.matrixWorld),(m=t.ray.origin.distanceTo(a))<t.near)||m>t.far||i.push({distance:m,point:u.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var L=hi(function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.j={}}),oi=(Object.assign(L.prototype,{k:function(t,i){this.B(t,i)||(void 0===this.j[t]&&(this.j[t]=[]),this.j[t].push(i))},B:function(t,i){return i?void 0!==this.j[t]&&-1!==this.j[t].indexOf(i):void 0!==this.j[t]&&0<this.j[t].length},I:function(t,i){void 0!==this.j[t]&&-1!==(i=this.j[t].indexOf(i))&&this.j[t].splice(i,1)},C:function(t){if(void 0!==this.j[t.type])for(var i=this.j[t.type].slice(0),n=0,s=i.length;n<s;n++)i[n].call(this,t)}}),L);function ui(t,i){return function(t){if(Array.isArray(t))return t}(t)||function(t,i){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var s,r,e,h,o=[],u=!0,a=!1;try{if(e=(n=n.call(t)).next,0===i){if(Object(n)!==n)return;u=!1}else for(;!(u=(s=e.call(n)).done)&&(o.push(s.value),o.length!==i);u=!0);}catch(t){a=!0,r=t}finally{try{if(!u&&null!=n.return&&(h=n.return(),Object(h)!==h))return}finally{if(a)throw r}}return o}}(t,i)||ai(t,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ai(t,i){var n;if(t)return"string"==typeof t?ci(t,i):"Map"===(n="Object"===(n=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ci(t,i):void 0}function ci(t,i){(null==i||i>t.length)&&(i=t.length);for(var n=0,s=new Array(i);n<i;n++)s[n]=t[n];return s}function fi(i,t){var n,s=Object.keys(i);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(i),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})),s.push.apply(s,n)),s}function li(s){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?fi(Object(r),!0).forEach(function(t){var i,n;i=s,n=r[t=t],(t=yi(t))in i?Object.defineProperty(i,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):i[t]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):fi(Object(r)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(r,t))})}return s}function vi(t){return(vi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function di(t,i){for(var n=0;n<i.length;n++){var s=i[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,yi(s.key),s)}}function yi(t){t=function(t,i){if("object"!==vi(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===i?String:Number)(t);n=n.call(t,i||"default");if("object"!==vi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"===vi(t)?t:String(t)}var L=function(){function i(t){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.P=t,this.V="none",this.currentobj=null,this._={url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH5QoOAiAd1TTTFgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAABfElEQVRYw81XO26EMBB9poAIrBwh2hPgMt1WS7cSN+AonAXtIahSpfLWVNtFewXLkG7SeCVIbH5rBZ40jYGZ8fjxPMOwDAcARwAnAO8A3sz6HcAVwAeATwBf8IgIQAGgA0AzrTPfRM8GPy8I6rLz2l1fPAR/2GVJNV4B3DwGf9jN+J7cuTM4Y4yEEFSWJUkpSWtNWmuSUlJZliSEIMbYVBKjlXCWPcsyUkrRFJRSlGXZ1HHMJ1wYhlRVFS1FVVUUhuFsYkau4FJKWgsp5VgSg6MobC+t2bmtEo4Ein4Cne3MfcHBia4vr3/YPodwc6GUcv0dh8Bo+wBpmoJz7k3LOedI09T26BiYi2WAPM/hGw6fJ9iE5xnmj/0RNmFihgwv/bS01ojj2GsF2rZFkiS/l78DbIzANBMDNE3jPZDD5z0wncwAdV17T8Dh82pVQSGEdxIKIZxquKkQ7UKKd3EZbX4db96Q7KIl20VTunlbvovBZBej2b8Np2zr8fwHFGE/6k/Mu0oAAAAASUVORK5CYII=",size:32,height:1,collision:!1},this.F={width:5,type:q.FULL,color:"#FF0000",height:3},this.L={color:"#FF0000",borderWidth:3,borderColor:"#0000FF",opacity:.5,height:3},this.D="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH5QocCDgHXcqo9wAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAEQ0lEQVRYw71XTWhcVRg9584kVGzHZKYlTFpsJ/PeKBaKMjN05aYIKgguupASqaKCC1cFVxaSaQW7dSW4KRFBEETEje5qtWK1SdP409L0zZgpJrEtvqY/qebNe/e46KSZDMkkmSR9mwdz35zv3O8737nfJdbxuG7xdQp7EfCj8au//NkORqzd4Lls8S0SgzR8UTHbm0qlr/r+9ORDIZDLFt6B4SDJXQBAci/AbHeyd8L3p6qbSsB1C++SLJHc0fg7yQyFbFd37z83b05d3hQCrls8SrBEcutS6yR3k8wnU713fH9qbEMJuG7hPYIDAAyAGsl447qk6wDmACQIPJVMpWd8f/r3lXDjqwne07PvUQmXBfUbKQS5U8AAyZ568LNW0RGJAalOyRgTRbN1srYVNtsR4Z49hSc6O3iKZBoArPTjzMzsCzduXLy7VizTDgGSAqCGXdDaqK3NmI0S6PYVSrgmAq6bP+S6+cKyzGI2WlxbsRWDbds6D7hu/vCqCOScwquAGaSNpZcDrNXCCEDYWJQoeowtSpYizIDrFl9rScBxiv0gBwn2yWhZwI4OGy4ioNZilhAA2G2AweZMxBvs9RVQA6RxJNQAPJ3LFW8jVCeoTruo77mjqYUTgD3oOIXbS6dZ++9LlRnKDDhOMfS8c589aEPHKRw0xDHS7G0wlrsADSBTz5RpSmuzEYUrdE584Vt7EVZHx8sjXzGXzb8sY44bch8e4mOlc5I9akA+u1xwafG7YWXdBAxZNOBLcYvwpLEdvTQ8tCiE1Q8wGJMQSYoEhhRrov6jkAD1Jsnk/Dkg4AsCNUgEDAFRBAGQQo6GzzWV7DsLfFnXQD5rYAZoeHh+h7I6Mu4Nf7gU+76+/ONxY07RsK9O9ufQ2ucrlZFbS33vOMV+Q3xCMvYguFTyvOHTBgA8b6Q8VwsGZe3QfHrZIs9RZAIRwarTfb+rVK/9mcja4543fHqRD1SrYxNBGJUEDa0IaMyaRGCpCKBk7RgjfVAuj5xa0ogmJkarsVhUkrVDUYtTlPxXBKM1HF5WUhnCifHK8DctrfjSpdFqENpSLDTfLgcYBGEIaG61BKRoGrTHx8vDn69qIJmYGG05WG7ZsjUEtGoNeN75cwDOtj0RAUAms79nYUfBNjIeNQnzkXQ6XwMAa2sEgGvXfp2dX17XROQ4ToLsehvgGw1/dObtVcI9wf5kAAokYI3A74Hax1eujE2ueyj1fX8ukeiZjMXMk4Y8QHI7SbMgMnSQ6AOZIZERUJEw5Hmjv23YVDwz8/etVGJXBUZZktkmVwPJusfbr62N3i+Xz5/Z8HuBPzN5rTvZe5VAhuSehjabD/4pYEued2F0025Gvj9VTXalrwvMk9y+cHbYoaAWliqVC96m3w39m9NXUqn0HYDPkOiywslaGB2rVi9U14rV9u3Y96fHkqmd92T1x1ygE9Xq+b/awfkfmzntCAO/rwcAAAAASUVORK5CYII=",this.H="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH5QoOAiAd1TTTFgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAABfElEQVRYw81XO26EMBB9poAIrBwh2hPgMt1WS7cSN+AonAXtIahSpfLWVNtFewXLkG7SeCVIbH5rBZ40jYGZ8fjxPMOwDAcARwAnAO8A3sz6HcAVwAeATwBf8IgIQAGgA0AzrTPfRM8GPy8I6rLz2l1fPAR/2GVJNV4B3DwGf9jN+J7cuTM4Y4yEEFSWJUkpSWtNWmuSUlJZliSEIMbYVBKjlXCWPcsyUkrRFJRSlGXZ1HHMJ1wYhlRVFS1FVVUUhuFsYkau4FJKWgsp5VgSg6MobC+t2bmtEo4Ein4Cne3MfcHBia4vr3/YPodwc6GUcv0dh8Bo+wBpmoJz7k3LOedI09T26BiYi2WAPM/hGw6fJ9iE5xnmj/0RNmFihgwv/bS01ojj2GsF2rZFkiS/l78DbIzANBMDNE3jPZDD5z0wncwAdV17T8Dh82pVQSGEdxIKIZxquKkQ7UKKd3EZbX4db96Q7KIl20VTunlbvovBZBej2b8Np2zr8fwHFGE/6k/Mu0oAAAAASUVORK5CYII=",this.objectArray=[],this.Y=[],this.N=[],this.X=[],this.U=[],this.Z=null,this.G=null,this.q=null,this.W=null,this.K=void 0,this.J="#FF0000",this.$=this.P.getRenderManager().renderer.domElement,this.tt=this.tt.bind(this),this.it=this.it.bind(this),this.nt=this.nt.bind(this),this.st=new it,this.rt=new oi,this.et=null,this.ht=null,this.ot()}var t,n,s;return t=i,(n=[{key:"editUrl",get:function(){return this.H},set:function(t){this.H=t}},{key:"centerUrl",get:function(){return this.D},set:function(t){this.D=t}},{key:"PointStyle",get:function(){return this._},set:function(t){this._=t}},{key:"operate",get:function(){return this.K},set:function(t){this.K=t;for(var i=0;i<this.X.length;i++)this.X[i].visible=!1,"move"===t?"center"===this.X[i]._opetype&&(this.X[i].visible=!0):"center"!==this.X[i]._opetype&&(this.X[i].visible=!0)}},{key:"LineStyle",get:function(){return this.F},set:function(t){this.F=t}},{key:"PolygonStyle",get:function(){return this.L},set:function(t){this.L=t}},{key:"DrawTool",get:function(){return this.V},set:function(t){if(this.V=t,"edit"!==this.V){for(var i=0;i<this.X.length;i++)this.X[i].remove();null!==this.ht&&(this.ht.parent.remove(this.ht),this.ht=null,this.P.enableUpdateRender()),this.Y.length=0,this.N.length=0,this.X.length=0,this.G=null,this.Z=null}}},{key:"edit",value:function(t,i){if("none"===this.DrawTool||"edit"===this.DrawTool)if(t&&t.shapetype){if(!(0<this.X.length||null!==this.ht)&&(i||null==this.G||this.G.id!==t.id)&&(!t.opetype||"no"===t.opetype.type)){for(var n=0;n<this.X.length;n++)this.X[n].remove();null!==this.ht&&(this.ht.parent.remove(this.ht),this.ht=null,this.P.enableUpdateRender()),this.X.length=0,this.Z=null,this.G=t,i||(this.W=t.id),t.type===fengmap.FMType.POLYGON_MARKER?(this.ut(t),this.DrawTool="edit"):t.type===fengmap.FMType.LINE_MARKER?(this.ct(t),this.DrawTool="edit"):t.type===fengmap.FMType.IMAGE_MARKER&&(this.DrawTool="edit",this.q=null,this.ft(t))}}else{for(var s=0;s<this.X.length;s++)this.X[s].remove();this.X.length=0,(this.G=null)!==this.ht&&(this.ht.parent.remove(this.ht),this.ht=null,this.P.enableUpdateRender())}}},{key:"on",value:function(t,i){this.rt.k(t,i)}},{key:"dispose",value:function(){this.$.removeEventListener("mousedown",this.tt,!1),this.$.removeEventListener("mousemove",this.it,!1),this.$.removeEventListener("mouseup",this.nt,!1)}},{key:"createMarkerByInfo",value:function(t){var i;if("circle"===t.shapetype||"ellipse"===t.shapetype||"rect"===t.shapetype||"polygon"===t.shapetype)return i=new fengmap.FMPolygonMarkerEdit(t),r=this.P.getFloor(t.level),i.addTo(r),i.mapEdit=this,t.id&&(i.id=t.id),i;if("line"!==t.shapetype)return r=this.P.getFloor(t.level),(i=new fengmap.FMImageMarkerEdit(t)).addTo(r),i.mapEdit=this,t.id&&(i.id=t.id),i;var n=new fengmap.FMSegment;n.points=[];for(var s=0;s<t.points.length;s++)n.points.push({x:t.points[s].x,y:t.points[s].y,z:t.points[s].z});n.level=t.level,t.segments=[n];var r=new fengmap.FMLineMarkerEdit(t);return r.addTo(this.P),r.mapEdit=this,t.id&&(r.id=t.id),r}}])&&di(t.prototype,n),s&&di(t,s),Object.defineProperty(t,"prototype",{writable:!1}),i}(),t=(Object.assign(L.prototype,{ot:function(){this.$.addEventListener("mousedown",this.tt,!1),this.$.addEventListener("mousemove",this.it,!1),this.$.addEventListener("mouseup",this.nt,!1)},lt:function(t,i){if(("none"===this.DrawTool||"edit"===this.DrawTool)&&(null!==this.ht&&(this.ht.parent.remove(this.ht),this.ht=null,this.P.enableUpdateRender()),t)&&(i||null==this.G||this.G.id!==t.id)&&(!t.opetype||"no"===t.opetype.type)){for(var n=0;n<this.X.length;n++)this.X[n].remove();this.X.length=0,this.Z=null,this.G=t,i||(this.W=t.id),t.type===fengmap.FMType.POLYGON_MARKER?(this.ut(t),this.DrawTool="edit"):t.type===fengmap.FMType.LINE_MARKER?(this.ct(t),this.DrawTool="edit"):t.type===fengmap.FMType.IMAGE_MARKER&&(this.DrawTool="edit",this.q=null,this.ft(t))}},vt:function(t){t=li({},t);return t.buildingID===this.P.getMapOptions().mapID&&(t.buildingID=null),t},dt:function(t,i){var n=new E;if(n.x=t/this.$.getBoundingClientRect().width*2-1,n.y=2*-(i/this.$.getBoundingClientRect().height)+1,"point"===this.G.shapetype)return t=[this.G.getRenderNode()],this.st.setFromCamera(n,this.P.camera),0<(i=this.st.intersectObjects(t,!0)).length?i[0].object:null;for(var s=[],r=0;r<this.X.length;r++)this.X[r].opetype.node.visible&&s.push(this.X[r].opetype.node);this.st.setFromCamera(n,this.P.camera);t=this.st.intersectObjects(s,!0);return 0<t.length?t[0].object:null},yt:function(t,i){var n=t.offsetX,t=t.offsetY,s=new w;s.x=n/this.$.clientWidth*2-1,s.y=2*-(t/this.$.clientHeight)+1,s.z=.5,this.st.setFromCamera(s,this.P.camera);var r,e=null,h=function(t,i){var n,s,r,e,h="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(h)return s=!(n=!0),{s:function(){h=h.call(t)},n:function(){var t=h.next();return n=t.done,t},e:function(t){s=!0,r=t},f:function(){try{n||null==h.return||h.return()}finally{if(s)throw r}}};if(Array.isArray(t)||(h=ai(t))||i&&t&&"number"==typeof t.length)return h&&(t=h),e=0,{s:i=function(){},n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:i};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(this.P.getRenderManager().getRenderList());try{for(h.s();!(r=h.n()).done;)for(var o=ui(r.value,2),u=(o[0],o[1]),a=this.st.intersectObject(u,!0),c=0;c<a.length;c++)a[c].object.mapNode&&(e=a[c].object)}catch(t){h.e(t)}finally{h.f()}null!==e&&e.mapNode?e.mapNode.type!==fengmap.FMType.LINE_MARKER?this.et={buildingID:e.mapNode.parent.parent.parent.buildingID,level:e.mapNode.level}:(n=e.mapNode.segments[0],this.et={buildingID:n.buildingID,level:n.level}):this.et={buildingID:this.P.getMapOptions().mapID,level:this.P.getLevel()},i&&i()},tt:function(s){var r=this;this.yt(s,function(){if("none"!==r.DrawTool)if(2===s.button)"edit"!==r.DrawTool?r.bt():(null!==r.Z||null!==r.G&&"point"===r.G.shapetype)&&r.Mt(),r.Z=null;else{var t=s.clientX-r.$.getBoundingClientRect().left,i=s.clientY-r.$.getBoundingClientRect().top;if("edit"===r.DrawTool){if(null===r.Z){if(null===r.G)return;var n=r.dt(t,i);"point"!==r.G.shapetype?null!==n&&(r.Z=n.mapNode,r.wt(!1)):null!==n&&(r.q={x:r.G.x,y:r.G.y},r.wt(!1))}}else{n=fengmap.FMUtil.coordsScreenToMap(r.P,{x:t,y:i});n.buildingID=r.et.buildingID,n.level=r.et.level,"point"===r.DrawTool?(r.gt(n),r.rt.C({type:"drawend",info:r.vt(r.currentobj.info),object:r.currentobj}),r.currentobj=null,r.et=null):"line"===r.DrawTool?r.Y.push(n):"circle"===r.DrawTool?0===r.N.length?r.N.push(n):(r.At(n),r.rt.C({type:"drawend",info:r.vt(r.currentobj.info),object:r.currentobj}),r.N.length=0,r.currentobj=null,r.et=null):"rect"===r.DrawTool?0===r.N.length?r.N.push(n):(r.Et(n),r.rt.C({type:"drawend",info:r.vt(r.currentobj.info),object:r.currentobj}),r.N.length=0,r.currentobj=null,r.et=null):"polygon"===r.DrawTool?r.N.push(n):"ellipse"===r.DrawTool&&(0===r.N.length?r.N.push(n):(r.St(n),r.rt.C({type:"drawend",info:r.vt(r.currentobj.info),object:r.currentobj}),r.N.length=0,r.currentobj=null,r.et=null))}}})},it:function(t){if("none"!==this.DrawTool){var i=t.clientX-this.$.getBoundingClientRect().left,t=t.clientY-this.$.getBoundingClientRect().top,i=fengmap.FMUtil.coordsScreenToMap(this.P,{x:i,y:t});if("edit"===this.DrawTool)return null!==this.G&&"point"===this.G.shapetype&&null!==this.q?(this.G.moveTo({animate:!1,x:i.x,y:i.y}),void this.rt.C({type:"drawing",info:this.vt(this.G.info),object:this.G})):void(null!==this.G&&null!==this.Z&&(this.Rt(i),this.G.id=this.W,this.rt.C({type:"drawing",info:this.vt(this.G.info),object:this.G})));"line"===this.DrawTool?this.jt(i):"circle"===this.DrawTool?this.At(i):"rect"===this.DrawTool?this.Et(i):"polygon"===this.DrawTool?this.xt(i):"ellipse"===this.DrawTool&&this.St(i),this.P.enableUpdateRender(),null!==this.currentobj&&this.rt.C({type:"drawing",info:this.vt(this.currentobj.info),object:this.currentobj})}},nt:function(t){if(2!==t.button&&"edit"===this.DrawTool&&null!==this.G&&("point"===this.G.shapetype||null!==this.Z)){if("point"===this.G.shapetype)this.lt(this.G,!0);else if("center"!==this.Z.opetype.type){if("ellipse"===this.G.shapetype||"circle"===this.G.shapetype)this.q=this.Ot(this.G.points);else if("rect"===this.G.shapetype){this.q=this.G.points;var t=this.Tt("center"),i=(t.visible=!0,void 0!==this.K&&"edit"===this.K&&(t.visible=!1),this.Tt("point",!0));t.position.x=(i[0].position.x+i[1].position.x)/2,t.position.z=(i[0].position.z+i[1].position.z)/2,this.U.length=0,this.U.push({x:Math.abs(i[0].position.x-i[1].position.x)/2,y:Math.abs(i[0].position.z-i[1].position.z)/2})}else if("polygon"===this.G.shapetype){this.q=this.G.points;for(var n=this.Ot(this.q).center,s=this.U.length=0;s<this.q.length;s++)this.U.push({x:this.q[s].x-n.x,y:this.q[s].y-n.y});t=this.Tt("center");t.position.x=n.x-this.P.x,t.position.z=this.P.y-n.y}else if("line"===this.G.shapetype){this.q=this.G.points;for(var r=this.Ot(this.q).center,e=this.U.length=0;e<this.q.length;e++)this.U.push({x:this.q[e].x-r.x,y:this.q[e].y-r.y});i=this.Tt("center");i.position.x=r.x-this.P.x,i.position.z=this.P.y-r.y}}else this.lt(this.G,!0);this.wt(!0),this.Z=null,this.G.id=this.W,this.rt.C({type:"editend",info:this.vt(this.G.info),object:this.G})}},ft:function(t){t.getRenderNode().position;var i=[new w(-.5,0,.5),new w(-.5,0,-.5),new w(.5,0,-.5),new w(.5,0,.5),new w(-.5,0,.5)],i=(new Qt).setFromPoints(i),n=new B({color:new l(this.J)}),i=(n.depthTest=!1,n.depthWrite=!1,new si(i,n));i.scale.set(1.1,1.1,1.1),t.getRenderNode().add(i),this.ht=i,this.P.enableUpdateRender()},Rt:function(t){if(null!==this.Z){var s=this;if("ellipse"!==this.G.shapetype?(this.Z.opetype.node.position.x=t.x-this.P.x,this.Z.opetype.node.position.z=this.P.y-t.y):"xradius"===this.Z.opetype.type?this.Z.opetype.node.position.x=t.x-this.P.x:("yradius"!==this.Z.opetype.type&&(this.Z.opetype.node.position.x=t.x-this.P.x),this.Z.opetype.node.position.z=this.P.y-t.y),"circle"===this.G.shapetype)"yradius"===this.Z.opetype.type?(e=A("center"),this.N.length=0,this.N.push({x:this.P.x+e.position.x,y:this.P.y-e.position.z}),this.At(t,!0)):(A("yradius").visible=!1,this.N.length=0,this.N.push({x:t.x,y:t.y}),this.At({x:t.x,y:t.y+this.q.yradius},!0));else if("ellipse"===this.G.shapetype)this.N.length=0,"yradius"===this.Z.opetype.type||"xradius"===this.Z.opetype.type?(e=A("center"),e={x:this.P.x+e.position.x,y:this.P.y-e.position.z},r=null,r="yradius"===this.Z.opetype.type?this.kt(e,this.q.xradius,Math.abs(e.y-t.y)):this.kt(e,Math.abs(e.x-t.x),this.q.yradius),this.St(r,!0)):(A("xradius").visible=!1,A("yradius").visible=!1,e=this.kt(t,this.q.xradius,this.q.yradius),this.St(e,!0));else if("rect"===this.G.shapetype)if("center"===this.Z.opetype.type){for(var i=A("point",!0),n=0;n<i.length;n++)i[n].visible=!1;this.N.length=0,this.N.push({x:t.x+this.U[0].x,y:t.y-this.U[0].y}),this.Et({x:t.x-this.U[0].x,y:t.y+this.U[0].y},!0)}else{var r=A("center"),e=A("point",r.visible=!1,this.Z.opetype.node.uuid);null!==e&&(this.N.length=0,this.N.push({x:this.P.x+e.position.x,y:this.P.y-e.position.z}),this.Et(t,!0))}else if("polygon"===this.G.shapetype)if("center"===this.Z.opetype.type){for(var h=this.Tt("point",!0),o=0;o<h.length;o++)h[o].visible=!1;for(var u=this.Z.opetype.node.position.x,a=this.Z.opetype.node.position.z,c=[],f=0;f<this.U.length;f++)c.push({x:u+this.U[f].x,y:a-this.U[f].y});this.xt(c,!0)}else{for(var l=this.Tt("point",!0),v=[],d=0;d<l.length;d++)v.push({x:l[d].position.x,y:l[d].position.z});this.xt(v,!0)}else if("line"===this.G.shapetype){var y=this.Tt("point",!0),p=[];if("center"===this.Z.opetype.type){for(var m=0;m<y.length;m++)y[m].visible=!1;for(var b=this.Z.opetype.node.position.x,M=this.Z.opetype.node.position.z,w=0;w<this.U.length;w++)p.push({x:b+this.U[w].x,y:M-this.U[w].y})}else for(var g=0;g<y.length;g++)p.push({x:y[g].position.x,y:y[g].position.z});this.jt(p,!0)}}function A(t,i,n){return s.Tt(t,i,n)}},Tt:function(t,i,n){var s=this,r=null;i&&(r=[]);for(var e=0;e<s.X.length;e++)if(s.X[e].opetype.type===t)if(i)(!n||s.X[e].opetype.node.uuid!==n)&&r.push(s.X[e].opetype.node);else{if(!n){r=s.X[e].opetype.node;break}if(s.X[e].opetype.node.uuid!==n){r=s.X[e].opetype.node;break}}return r},bt:function(){var t;"line"===this.DrawTool?this.jt():"circle"===this.DrawTool?this.At():"rect"===this.DrawTool?this.Et():"polygon"===this.DrawTool?this.xt():"ellipse"===this.DrawTool&&this.St(),"line"!==this.DrawTool&&"polygon"!==this.DrawTool||(t=!0,"line"===this.DrawTool?this.Y.length<2&&(t=!1):"polygon"===this.DrawTool&&this.N.length<3&&(t=!1),t&&(this.rt.C({type:"drawend",info:this.vt(this.currentobj.info),object:this.currentobj}),this.et=null),"line"===this.DrawTool&&(this.Y.length=0,this.currentobj=null),"polygon"===this.DrawTool&&(this.N.length=0,this.currentobj=null))},Mt:function(){if(this.q){if("circle"===this.G.shapetype)this.N.length=0,this.N.push({x:this.q.center.x,y:this.q.center.y}),this.At({x:this.q.center.x,y:this.q.center.y+this.q.yradius},!0);else if("ellipse"===this.G.shapetype){this.N.length=0;var t=this.kt({x:this.q.center.x,y:this.q.center.y},this.q.xradius,this.q.yradius);this.St(t,!0)}else if("rect"===this.G.shapetype)this.Et(),this.lt(this.G);else if("polygon"===this.G.shapetype){for(var i=[],n=0;n<this.q.length;n++)i.push({x:this.q[n].x-this.P.x,y:this.P.y-this.q[n].y});this.xt(i,!0)}else if("line"===this.G.shapetype){for(var s=[],r=0;r<this.q.length;r++)s.push({x:this.q[r].x-this.P.x,y:this.P.y-this.q[r].y});this.jt(s,!0)}else if("point"===this.G.shapetype)return this.G.moveTo({animate:!1,x:this.q.x,y:this.q.y}),this.rt.C({type:"editend",info:this.vt(this.G.info),object:this.G}),void(this.G=null);this.G.id=this.W,this.rt.C({type:"editend",info:this.vt(this.G.info),object:this.G}),this.lt(this.G,!0)}},gt:function(t){var i,n={},s=this.PointStyle;for(i in s)n[i]=s[i];n.x=t.x,n.y=t.y,n.buildingID=this.et.buildingID;var t=this.P.getBuilding(this.et.buildingID).getFloor(this.et.level),r=new fengmap.FMImageMarkerEdit(n);r.addTo(t),(r.mapEdit=this).currentobj=r},jt:function(t,i){var n,s=new fengmap.FMSegment,r=(s.points=[],{}),e=this.LineStyle;for(n in e)r[n]=e[n];if(void 0===r.height&&(r.height=3),i){null!==this.G&&this.G.remove();for(var h=0;h<t.length;h++)s.points.push({x:this.P.x+t[h].x,y:this.P.y-t[h].y,z:r.height})}else{if(0===this.Y.length)return;if(null!==this.currentobj&&(this.currentobj.remove(),!t)&&1===this.Y.length)return;for(var o=0;o<this.Y.length;o++)s.points.push({x:this.Y[o].x,y:this.Y[o].y,z:r.height});t&&s.points.push({x:t.x,y:t.y,z:r.height})}i?(s.level=this.et.level,s.buildingID=this.et.buildingID):(s.level=this.Y[0].level,s.buildingID=this.Y[0].buildingID),r.segments=[s];var u=new fengmap.FMLineMarkerEdit(r);u.addTo(this.P),u.mapEdit=this,i?this.G=u:this.currentobj=u},At:function(t,i){if(0!==this.N.length){if(i)null!==this.G&&this.G.remove();else if(null!==this.currentobj&&(this.currentobj.remove(),!t))return this.N.length=0,void(this.currentobj=null);var n,s=this.N[0],t=Math.sqrt((s.x-t.x)*(s.x-t.x)+(s.y-t.y)*(s.y-t.y)),r=this.PolygonStyle,e={};for(n in r)e[n]=r[n];e.points=fengmap.FMCalculator.circleBuilder(t,this.N[0],32),e.shapetype="circle";var h,t=new fengmap.FMPolygonMarkerEdit(e);i?(h=this.P.getBuilding(this.et.buildingID).getFloor(this.et.level),t.addTo(h)):(h=this.P.getBuilding(s.buildingID).getFloor(s.level),t.addTo(h)),t.mapEdit=this,i?this.G=t:this.currentobj=t}},Et:function(t,i){var n=[];if(t||i){if(0===this.N.length)return;if(i)null!==this.G&&this.G.remove();else if(null!==this.currentobj&&(this.currentobj.remove(),!t))return this.N.length=0,void(this.currentobj=null);var s=this.N[0],n=[s,{x:t.x,y:s.y},t,{x:s.x,y:t.y}]}else if("edit"===mapdraw.DrawTool)n=this.q,null!==this.G&&this.G.remove();else if(null!==this.currentobj)return this.currentobj.remove(),this.N.length=0,void(this.currentobj=null);if(0!==n.length){var r,e=this.PolygonStyle,h={};for(r in e)h[r]=e[r];h.points=n,h.shapetype="rect";s=new fengmap.FMPolygonMarkerEdit(h);i?(n=this.P.getBuilding(this.et.buildingID).getFloor(this.et.level),s.addTo(n)):(n=this.P.getBuilding(this.N[0].buildingID).getFloor(this.N[0].level),s.addTo(n)),s.mapEdit=this,!t&&!i||i?this.G=s:this.currentobj=s}},xt:function(t,i){var n=[];if(i){null!==this.G&&this.G.remove();for(var s=0;s<t.length;s++)n.push({x:this.P.x+t[s].x,y:this.P.y-t[s].y})}else{if(0===this.N.length)return;null!==this.currentobj&&this.currentobj.remove();for(var r=0;r<this.N.length;r++)n.push({x:this.N[r].x,y:this.N[r].y});if(t)n.push({x:t.x,y:t.y});else if(2===n.length)return}var e,h=this.PolygonStyle,o={};for(e in h)o[e]=h[e];o.points=n;var u,a=new fengmap.FMPolygonMarkerEdit(o);i?(u=this.P.getBuilding(this.et.buildingID).getFloor(this.et.level),a.addTo(u)):(u=this.P.getBuilding(this.N[0].buildingID).getFloor(this.N[0].level),a.addTo(u)),a.mapEdit=this,i?this.G=a:this.currentobj=a},St:function(t,i){var n=null;if(i)null!==this.G&&this.G.remove(),n=t;else{if(0===this.N.length)return;if(null!==this.currentobj&&this.currentobj.remove(),!t)return this.N.length=0,void(this.currentobj=null);var s=this.N[0],r=Math.abs(t.x-s.x),t=Math.abs(t.y-s.y),n=t<r?this.kt(s,r,r/2):this.kt(s,t/2,t)}for(var e=[],h=0;h<n.length;h++)e.push({x:n[h].x,y:n[h].y});var o,u=this.PolygonStyle,a={};for(o in u)a[o]=u[o];a.points=e,a.shapetype="ellipse";r=new fengmap.FMPolygonMarkerEdit(a);i?(s=this.P.getBuilding(this.et.buildingID).getFloor(this.et.level),r.addTo(s)):(t=this.P.getBuilding(this.N[0].buildingID).getFloor(this.N[0].level),r.addTo(t)),r.mapEdit=this,i?this.G=r:this.currentobj=r},kt:function(t,i,n){return new G(t.x,t.y,i,n,0,2*Math.PI,!1,0).getPoints(32)},ct:function(t){for(var i=[],n=(this.q=t.points,this.Ot(t.points).center),s=this.U.length=0;s<t.points.length;s++)i.push(t.points[s]),this.U.push({x:t.points[s].x-n.x,y:t.points[s].y-n.y});i.push({x:n.x,y:n.y,optype:"center"}),this.Bt(i,t)},ut:function(t){var i,n=this,s=[];if("polygon"===t.shapetype){this.q=t.points;for(var r=this.Ot(t.points).center,e=this.U.length=0;e<t.points.length;e++)s.push(t.points[e]),this.U.push({x:t.points[e].x-r.x,y:t.points[e].y-r.y});s.push({x:r.x,y:r.y,optype:"center"})}else"rect"===t.shapetype?(this.q=t.points,s.push(t.points[0]),s.push(t.points[2]),s.push({x:(t.points[0].x+t.points[2].x)/2,y:(t.points[0].y+t.points[2].y)/2,optype:"center"}),this.U.length=0,this.U.push({x:Math.abs(t.points[0].x-t.points[2].x)/2,y:Math.abs(t.points[0].y-t.points[2].y)/2})):"circle"!==t.shapetype&&"ellipse"!==t.shapetype||(i=this.Ot(t.points),this.q=i,s.push({x:i.center.x,y:i.center.y,optype:"center"}),s.push({x:i.center.x,y:i.center.y+i.yradius,optype:"yradius"}),"ellipse"===t.shapetype&&s.push({x:i.center.x+i.xradius,y:i.center.y,optype:"xradius"}));n.Bt(s,t)},Bt:function(t,i){for(var n=this,s=(n.P.getFloor(n.P.getLevel()),0);s<t.length;s++){var r=(r=t[s].optype)||"point",e=n.editUrl,e=("center"===r&&(e=n.centerUrl),new fengmap.FMImageMarkerEdit({url:e,size:16,height:i.height+1,x:t[s].x,y:t[s].y,collision:!1,opetype:r})),h=this.P.getBuilding(i.info.buildingID).getFloor(i.info.level);e.addTo(h),void 0!==this.K&&("move"===this.K?"center"!==r&&(e.visible=!1):"edit"===this.K&&"center"===r&&(e.visible=!1)),n.X.push(e)}},Ot:function(t){for(var i=null,n=null,s=null,r=null,e=0;e<t.length;e++)0===e?(i=t[e].x,n=t[e].y,s=t[e].x,r=t[e].y):(i>t[e].x&&(i=t[e].x),n>t[e].y&&(n=t[e].y),s<t[e].x&&(s=t[e].x),r<t[e].y&&(r=t[e].y));return{center:{x:(i+s)/2,y:(n+r)/2},xradius:Math.abs(s-i)/2,yradius:Math.abs(r-n)/2}},It:function(t){var i=t.buildingID,t=t.level;null===i&&(i=this.P.getMapOptions().mapID,t=this.P.getLevel()),null===this.currentobj&&(this.et={buildingID:i,level:t})},wt:function(t){var i=this.P.getInteracations();i.enableDrag=t,i.enableRotate=t,i.enableTilt=t,i.enableZoom=t}}),{NONE:0,EXTRUDE_MARKER:2,IMAGE_MARKER:8,LOCATION_MARKER:16,POLYGON_MARKER:32,TEXT_MARKER:64,LINE_MARKER:128,LINE3D_MARKER:256,HEAT_MAP_MARKER:512,EXTENT:1024,EXTERNAL_MODEL:2048,MODEL:4096,FACILITY:8192,LABEL:16384,DYNAMIC_MODEL_MARKER:32768,DOM_MARKER:65536,SPHERE_MARKER:1<<17,EXTENT_LAYER:1<<20,EXTERNAL_MODEL_LAYER:1<<21,MODEL_LAYER:1<<22,FACILITY_LAYER:1<<23,LABEL_LAYER:1<<24,MARKER_GROUP:1<<25,FLOW_LINE_LAYER:1<<27,FLOW_LINE_MARKER:1<<27,FIRE_MARKER:1<<28,WALL_MARKER:1<<29,TUBE_MARKER:1<<30}),pi=(t.LAYER_NODE_TYPE=new Map,t.LAYER_NODE_TYPE.set(t.EXTENT_LAYER,t.EXTENT),t.LAYER_NODE_TYPE.set(t.EXTERNAL_MODEL_LAYER,t.EXTERNAL_MODEL),t.LAYER_NODE_TYPE.set(t.MODEL_LAYER,t.MODEL),t.LAYER_NODE_TYPE.set(t.FACILITY_LAYER,t.FACILITY),t.LAYER_NODE_TYPE.set(t.LABEL_LAYER,t.LABEL),t.LAYER_NODE_TYPE.set(t.DOM_MARKER,t.DOM_MARKER),t.LAYER_NODE_TYPE.set(t.DYNAMIC_MODEL_MARKER,t.DYNAMIC_MODEL_MARKER),t.LAYER_NODE_TYPE.set(t.EXTRUDE_MARKER,t.EXTRUDE_MARKER),t.LAYER_NODE_TYPE.set(t.HEAT_MAP_MARKER,t.HEAT_MAP_MARKER),t.LAYER_NODE_TYPE.set(t.LINE_MARKER,t.LINE_MARKER),t.LAYER_NODE_TYPE.set(t.LOCATION_MARKER,t.LOCATION_MARKER),t.LAYER_NODE_TYPE.set(t.POLYGON_MARKER,t.POLYGON_MARKER),t.LAYER_NODE_TYPE.set(t.TEXT_MARKER,t.TEXT_MARKER),t.LAYER_NODE_TYPE.set(t.IMAGE_MARKER,t.IMAGE_MARKER),t.LAYER_NODE_TYPE.set(t.FLOW_LINE_LAYER,t.FLOW_LINE_MARKER),t.LAYER_NODE_TYPE.set(t.FIRE_MARKER,t.FIRE_MARKER),t.LAYER_NODE_TYPE.set(t.WALL_MARKER,t.WALL_MARKER),t.LAYER_NODE_TYPE.set(t.TUBE_MARKER,t.TUBE_MARKER),t.LAYER_NODE_TYPE.set(t.LINE3D_MARKER,t.LINE3D_MARKER),t.LAYER_NODE_TYPE.set(t.SPHERE_MARKER,t.SPHERE_MARKER),t),mi=function(t,i,n){n=n||2;var s,r,e,h,o,u=i&&i.length,a=u?i[0]*n:t.length,c=bi(t,0,a,n,!0),f=[];if(c&&c.next!==c.prev){if(u&&(c=function(t,i,n,s){var r,e,h,o,u=[];for(r=0,e=i.length;r<e;r++)o=i[r]*s,h=r<e-1?i[r+1]*s:t.length,(o=bi(t,o,h,s,!1))===o.next&&(o.steiner=!0),u.push(function(t){var i=t,n=t;for(;(i.x<n.x||i.x===n.x&&i.y<n.y)&&(n=i),i=i.next,i!==t;);return n}(o));for(u.sort(wi),r=0;r<u.length;r++)!function(t,i){(i=function(t,i){var n,s=i,r=t.x,e=t.y,h=-1/0;do{if(e<=s.y&&e>=s.next.y&&s.next.y!==s.y){var o=s.x+(e-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(o<=r&&h<o){if((h=o)===r){if(e===s.y)return s;if(e===s.next.y)return s.next}n=s.x<s.next.x?s:s.next}}}while(s=s.next,s!==i);if(!n)return null;if(r!==h){var u,a=n,c=n.x,f=n.y,l=1/0;for(s=n;r>=s.x&&s.x>=c&&r!==s.x&&Ai(e<f?r:h,e,c,f,e<f?h:r,e,s.x,s.y)&&(u=Math.abs(e-s.y)/(r-s.x),xi(s,t))&&(u<l||u===l&&(s.x>n.x||s.x===n.x&&function(t,i){return C(t.prev,t,i.prev)<0&&C(i.next,t,t.next)<0}(n,s)))&&(n=s,l=u),(s=s.next)!==a;);}return n}(t,i))&&(t=Oi(i,t),I(i,i.next),I(t,t.next))}(u[r],n),n=I(n,n.next);return n}(t,i,c,n)),t.length>80*n){for(var l=s=t[0],v=r=t[1],d=n;d<a;d+=n)(e=t[d])<l&&(l=e),(h=t[d+1])<v&&(v=h),s<e&&(s=e),r<h&&(r=h);o=0!==(o=Math.max(s-l,r-v))?1/o:0}Mi(c,f,n,l,v,o)}return f};function bi(t,i,n,s,r){var e,h;if(r===0<function(t,i,n,s){for(var r=0,e=i,h=n-s;e<n;e+=s)r+=(t[h]-t[e])*(t[e+1]+t[h+1]),h=e;return r}(t,i,n,s))for(e=i;e<n;e+=s)h=Ti(e,t[e],t[e+1],h);else for(e=n-s;i<=e;e-=s)h=Ti(e,t[e],t[e+1],h);return h&&Ei(h,h.next)&&(ki(h),h=h.next),h}function I(t,i){if(!t)return t;i=i||t;var n,s=t;do{if(n=!1,s.steiner||!Ei(s,s.next)&&0!==C(s.prev,s,s.next))s=s.next;else{if(ki(s),(s=i=s.prev)===s.next)break;n=!0}}while(n||s!==i);return i}function Mi(t,i,n,s,r,e,h){if(t){if(!h&&e){for(var o=t,u=s,a=r,c=e,f=o;null===f.z&&(f.z=gi(f.x,f.y,u,a,c)),f.prevZ=f.prev,f.nextZ=f.next,(f=f.next)!==o;);f.prevZ.nextZ=null,f.prevZ=null;var l,v,d,y,p,m,b,M,w=f,g=1;do{for(v=w,p=w=null,m=0;v;){for(m++,d=v,l=b=0;l<g&&(b++,d=d.nextZ);l++);for(M=g;0<b||0<M&&d;)0!==b&&(0===M||!d||v.z<=d.z)?(v=(y=v).nextZ,b--):(d=(y=d).nextZ,M--),p?p.nextZ=y:w=y,y.prevZ=p,p=y;v=d}}while(p.nextZ=null,g*=2,1<m)}for(var A,E,S=t;t.prev!==t.next;)if(A=t.prev,E=t.next,e?function(t,i,n,s){var r=t.prev,e=t,h=t.next;if(0<=C(r,e,h))return;var o=(r.x<e.x?r.x<h.x?r:h:e.x<h.x?e:h).x,u=(r.y<e.y?r.y<h.y?r:h:e.y<h.y?e:h).y,a=(r.x>e.x?r.x>h.x?r:h:e.x>h.x?e:h).x,c=(r.y>e.y?r.y>h.y?r:h:e.y>h.y?e:h).y,f=gi(o,u,i,n,s),l=gi(a,c,i,n,s),v=t.prevZ,d=t.nextZ;for(;v&&v.z>=f&&d&&d.z<=l;){if(v!==t.prev&&v!==t.next&&Ai(r.x,r.y,e.x,e.y,h.x,h.y,v.x,v.y)&&0<=C(v.prev,v,v.next))return;if(v=v.prevZ,d!==t.prev&&d!==t.next&&Ai(r.x,r.y,e.x,e.y,h.x,h.y,d.x,d.y)&&0<=C(d.prev,d,d.next))return;d=d.nextZ}for(;v&&v.z>=f;){if(v!==t.prev&&v!==t.next&&Ai(r.x,r.y,e.x,e.y,h.x,h.y,v.x,v.y)&&0<=C(v.prev,v,v.next))return;v=v.prevZ}for(;d&&d.z<=l;){if(d!==t.prev&&d!==t.next&&Ai(r.x,r.y,e.x,e.y,h.x,h.y,d.x,d.y)&&0<=C(d.prev,d,d.next))return;d=d.nextZ}return 1}(t,s,r,e):function(t){var i=t.prev,n=t,s=t.next;if(0<=C(i,n,s))return;var r=t.next.next;for(;r!==t.prev;){if(Ai(i.x,i.y,n.x,n.y,s.x,s.y,r.x,r.y)&&0<=C(r.prev,r,r.next))return;r=r.next}return 1}(t))i.push(A.i/n),i.push(t.i/n),i.push(E.i/n),ki(t),t=E.next,S=E.next;else if((t=E)===S){h?1===h?Mi(t=function(t,i,n){var s=t;do{var r=s.prev,e=s.next.next}while(!Ei(r,e)&&Si(r,s,s.next,e)&&xi(r,e)&&xi(e,r)&&(i.push(r.i/n),i.push(s.i/n),i.push(e.i/n),ki(s),ki(s.next),s=t=e),s=s.next,s!==t);return I(s)}(I(t),i,n),i,n,s,r,e,2):2===h&&function(t,i,n,s,r,e){var h=t;do{for(var o,u=h.next.next;u!==h.prev;){if(h.i!==u.i&&function(t,i){return t.next.i!==i.i&&t.prev.i!==i.i&&!function(t,i){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==i.i&&n.next.i!==i.i&&Si(n,n.next,t,i))return 1}while(n=n.next,n!==t);return}(t,i)&&(xi(t,i)&&xi(i,t)&&function(t,i){var n=t,s=!1,r=(t.x+i.x)/2,e=(t.y+i.y)/2;for(;n.y>e!=n.next.y>e&&n.next.y!==n.y&&r<(n.next.x-n.x)*(e-n.y)/(n.next.y-n.y)+n.x&&(s=!s),n=n.next,n!==t;);return s}(t,i)&&(C(t.prev,t,i.prev)||C(t,i.prev,i))||Ei(t,i)&&0<C(t.prev,t,t.next)&&0<C(i.prev,i,i.next))}(h,u))return o=Oi(h,u),h=I(h,h.next),o=I(o,o.next),Mi(h,i,n,s,r,e),Mi(o,i,n,s,r,e);u=u.next}}while(h=h.next,h!==t)}(t,i,n,s,r,e):Mi(I(t),i,n,s,r,e,1);break}}}function wi(t,i){return t.x-i.x}function gi(t,i,n,s,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-s)*r)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function Ai(t,i,n,s,r,e,h,o){return 0<=(r-h)*(i-o)-(t-h)*(e-o)&&0<=(t-h)*(s-o)-(n-h)*(i-o)&&0<=(n-h)*(e-o)-(r-h)*(s-o)}function C(t,i,n){return(i.y-t.y)*(n.x-i.x)-(i.x-t.x)*(n.y-i.y)}function Ei(t,i){return t.x===i.x&&t.y===i.y}function Si(t,i,n,s){var r=ji(C(t,i,n)),e=ji(C(t,i,s)),h=ji(C(n,s,t)),o=ji(C(n,s,i));return r!==e&&h!==o||0===r&&Ri(t,n,i)||0===e&&Ri(t,s,i)||0===h&&Ri(n,t,s)||!(0!==o||!Ri(n,i,s))}function Ri(t,i,n){return i.x<=Math.max(t.x,n.x)&&i.x>=Math.min(t.x,n.x)&&i.y<=Math.max(t.y,n.y)&&i.y>=Math.min(t.y,n.y)}function ji(t){return 0<t?1:t<0?-1:0}function xi(t,i){return C(t.prev,t,t.next)<0?0<=C(t,i,t.next)&&0<=C(t,t.prev,i):C(t,i,t.prev)<0||C(t,t.next,i)<0}function Oi(t,i){var n=new Bi(t.i,t.x,t.y),s=new Bi(i.i,i.x,i.y),r=t.next,e=i.prev;return(t.next=i).prev=t,(n.next=r).prev=n,(s.next=n).prev=s,(e.next=s).prev=e,s}function Ti(t,i,n,s){t=new Bi(t,i,n);return s?(t.next=s.next,(t.prev=s).next.prev=t,s.next=t):(t.prev=t).next=t,t}function ki(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Bi(t,i,n){this.i=t,this.x=i,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ii(t){return function(t){if(Array.isArray(t))return Ci(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,i){var n;if(t)return"string"==typeof t?Ci(t,i):"Map"===(n="Object"===(n=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ci(t,i):void 0}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ci(t,i){(null==i||i>t.length)&&(i=t.length);for(var n=0,s=new Array(i);n<i;n++)s[n]=t[n];return s}var Pi={area:function(t){for(var i=t.length,n=0,s=i-1,r=0;r<i;s=r++)n+=t[s].x*t[r].y-t[r].x*t[s].y;return.5*n},isClockWise:function(t){return Pi.area(t)<0},triangulateShape:function(t,i){var n=[],s=[],r=[],e=(Vi(t),_i(n,t),t.length);i.forEach(Vi);for(var h=0;h<i.length;h++)s.push(e),e+=i[h].length,_i(n,i[h]);for(var o=mi(n,s),u=0;u<o.length;u+=3)r.push(o.slice(u,u+3));return r},triangulate:function(t){(r=[]).push.apply(r,Ii(t[0]));for(var i=[],n=1;n<t.length;n++){var s=[];s.push.apply(s,Ii(t[n])),i.push(s)}if(!Pi.isClockWise(r))for(var r=r.reverse(),e=0,h=i.length;e<h;e++){var o=i[e];Pi.isClockWise(o)&&(i[e]=o.reverse())}return Pi.triangulateShape(r,i)}};function Vi(t){var i,n=t.length;2<n&&(n=t[n-1],i=t[0],n.x===i.x)&&n.y===i.y&&t.pop()}function _i(t,i){for(var n=0;n<i.length;n++)t.push(i[n].x),t.push(i[n].y)}function Fi(t){return(Fi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Li(t,i){for(var n=0;n<i.length;n++){var s=i[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,function(t){t=function(t,i){if("object"!==Fi(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===i?String:Number)(t);n=n.call(t,i||"default");if("object"!==Fi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"===Fi(t)?t:String(t)}(s.key),s)}}function Di(t,i,n){return i&&Li(t.prototype,i),n&&Li(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var P=1e-5,Hi=.001,Yi=Math.PI/180,Ni=180/Math.PI,t=Di(function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function")});Object.assign(t.prototype,{Ct:function(){return P},Pt:function(){return Yi},Vt:function(){return Ni},_t:function(t){return t<P&&-P<t},Ft:function(t){return P<t},Lt:function(t){return t<-P},Dt:function(t,i,n){i=(t.x-n.x)*(i.y-n.y)-(i.x-n.x)*(t.y-n.y);return Math.abs(i)<P?0:i},distanceOfTwoPoints:function(t,i){return t&&i?Math.sqrt((t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y)):Number.NaN},distance:function(t,i){return Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2))},isPolygonContainPoint:function(t,i){for(var n=0,s=0;s<t.length;s++){var r=t[s].x,e=t[s].y,h=0,o=0,o=(s<t.length-1?(h=t[s+1].x,t[s+1]):(h=t[0].x,t[0])).y;if(r===i.x&&e===i.y||h===i.x&&o===i.y)return!0;if(o!==e){var u=r+(i.y-e)*(h-r)/(o-e);if(u===i.x)return!0;r!==h?u<=Math.max(r,h)&&u>=Math.min(r,h)&&u>i.x&&u!==r&&(u===h&&0<(e-i.y)*(o-i.y)?n+=2:n++):u<=Math.max(r,h)&&u>=Math.min(r,h)&&u>i.x&&(u===h&&0<(e-i.y)*(o-i.y)?n+=2:n++)}}return 0<n%2},Ht:function(t,i,n,s){return!(Math.max(t.x,i.x)<Math.min(n.x,s.x)||Math.max(t.y,i.y)<Math.min(n.y,s.y)||Math.max(n.x,s.x)<Math.min(t.x,i.x)||Math.max(n.y,s.y)<Math.min(t.y,i.y))},Yt:function(t,i,n,s){return!(Math.max(t.x,i.x)<Math.min(n.x,s.x)||Math.max(t.y,i.y)<Math.min(n.y,s.y)||Math.max(n.x,s.x)<Math.min(t.x,i.x)||Math.max(n.y,s.y)<Math.min(t.y,i.y)||0===this.Dt(n,i,t)&&0===this.Dt(i,s,t)||this.Dt(n,i,t)*this.Dt(i,s,t)<0||this.Dt(t,s,n)*this.Dt(s,i,n)<0)},Nt:function(t,i,n){return!(t.x<i.x||t.y<i.y||t.x>n.x||t.y>n.y)},Xt:function(t,i,n){var s=Math.min(i.x,n.x),r=Math.max(i.x,n.x),e=Math.min(i.y,n.y),i=Math.max(i.y,n.y);return!(t.x<s||t.x>r||t.y<e||t.y>i)},Ut:function(t,i,n){var s=Math.min(n.x,i.x),r=Math.max(n.x,i.x),e=Math.min(n.y,i.y),n=Math.max(n.y,i.y);return!(t.x<s||t.x>r||t.y<e||t.y>n)},Zt:function(t,i,n){for(var s,r,e=!1,h=0;h<n;h++)s=i[h],r=i[(h+1)%n],(s.y<t.y&&r.y>=t.y||r.y<t.y&&s.y>=t.y)&&(s.x<=t.x||r.x<=t.x)&&s.x+(t.y-s.y)/(r.y-s.y)*(r.x-s.x)<t.x&&(e=!e);return e},Gt:function(t,i,n){return(t.x-i.x)*(n.y-i.y)==(n.x-i.x)*(t.y-i.y)&&Math.min(i.x,n.x)<=t.x&&t.x<=Math.max(i.x,n.x)&&Math.min(i.y,n.y)<=t.y&&t.y<=Math.max(i.y,n.y)},qt:function(t,i){return Math.sqrt((t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y))},zt:function(t,i){return(t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y)},Qt:function(t,i,n){var s=i.x,i=i.y,r=n.x,n=n.y,e=t.x,t=t.y,h=r-s,o=n-i,u=h*h+o*o,a=e-s,c=t-i,f=a*a+c*c;return this._t(u)?this._t(f)?0:f:(u=Math.sqrt(u),c=this.Ft(o=(h=h/u)*a+(a=o/u)*c)?this.Lt(o-u)?(c=e-(s+o*h))*c+(u=t-(i+o*a))*u:(s=e-r)*s+(h=t-n)*h:f,this._t(c)?0:c)},Wt:function(t,i,n,s){var r,e=i.x,h=i.y,o=n.x,u=n.y,a=t.x,t=t.y,c=o-e,f=u-h,l=Math.sqrt(c*c+f*f),v=a-e,d=t-h,y=Math.sqrt(v*v+d*d);return this._t(l)?(s.x=i.x,s.y=i.y,this._t(r=y)?0:r):(r=this.Ft(f=(c=c/l)*v+(v=f/l)*d)?this.Lt(f-l)?(l=a-(d=e+f*c),c=t-(e=h+f*v),h=Math.sqrt(l*l+c*c),s.x=d,s.y=e,h):(f=a-o,v=t-u,l=Math.sqrt(f*f+v*v),s.x=n.x,s.y=n.y,l):(s.x=i.x,s.y=i.y,y),this._t(r)?0:r)},Kt:function(t,i){for(var n=0,s=0,r=0,e=0;e<i;e++){var h=t[e],o=t[(e+1)%i],u=(h.x*o.y-h.y*o.x)/2;n+=u,s+=u*(h.x+o.x)/3,r+=u*(h.y+o.y)/3}return{x:s/=n,y:r/=n}},Jt:function(t){for(var i=Pi.triangulate([t]),n=0,s=0,r=0,e=0;e<i.length;e++){var h=t[i[e][0]],o=t[i[e][1]],u=t[i[e][2]],a=o.x-h.x,c=o.y-h.y,f=u.x-h.x,a=(a*(u.y-h.y)-f*c)/2;n+=a,s+=(h.x+o.x+u.x)/3*a,r+=(h.y+o.y+u.y)/3*a}return{x:s/n,y:r/n}},$t:function(t,i){if(i<3)return 0;for(var n=0,s=0;s<i;++s){var r=t[s],e=t[(s+1)%i];n+=r.x*e.y-r.y*e.x}return Math.abs(n/2)},ti:function(t,i,n,s,r){var e,h;return this.Yt(t,i,n,s)?(e=(s.x-n.x)*(t.y-i.y)-(i.x-t.x)*(n.y-s.y),h=(t.y-n.y)*(i.x-t.x)*(s.x-n.x)+n.x*(s.y-n.y)*(i.x-t.x)-t.x*(i.y-t.y)*(s.x-n.x),r.x=h/e,e=(t.x-i.x)*(s.y-n.y)-(i.y-t.y)*(n.x-s.x),h=i.y*(t.x-i.x)*(s.y-n.y)+(s.x-i.x)*(s.y-n.y)*(t.y-i.y)-s.y*(n.x-s.x)*(i.y-t.y),r.y=h/e,1):0},ii:function(t,i,n,s,r){var e=Math.min(n.x,s.x),h=Math.max(n.x,s.x),o=Math.min(n.y,s.y),u=Math.max(n.y,s.y),a=t.x,c=t.y,f=n.x,l=n.y,v=s.x,d=s.y;if(90==i)return!(t.x<e||t.x>h||(Math.abs(h-e<Hi)?t.y>=l&&t.y<=d||t.y>=d&&t.y<=l?(r.x=t.x,r.y=t.y,0):l<d&&t.x<l?(r.x=f,r.y=l,0):!(d<l&&t.x<d)||(r.x=v,r.y=d,0):(r.y=y=(d-l)/(v-f)*(a-f)+l,r.x=a,y<c||!this.Ut(r,n,s))));if(270==i)return!(t.x<e||t.x>h||(Math.abs(h-e<Hi)?t.y>=l&&t.y<=d||t.y>=d&&t.y<=l?(r.x=t.x,r.y=t.y,0):l<d&&t.y>d?(r.x=v,r.y=d,0):!(d<l&&t.y>l)||(r.x=f,r.y=l,0):(r.y=y=(d-l)/(v-f)*(a-f)+l,r.x=a,c<y||!this.Ut(r,n,s))));if(270!=i&&90!=i&&Math.abs(h-e<Hi)){var t=e,y=Math.tan(i/180*Math.PI)*(t-a)+c;if(r.y=y,r.x=t,this.Ut(r,n,s))return h=y-c,0<(e=t-a)/Math.sqrt(e*e+h*h)*Math.cos(i/180*Math.PI)}return Math.abs(u-o<=Hi)?(y=o,t=1/Math.tan(i/180*Math.PI)*(y-c)+a,r.x=t,r.y=y,!!this.Ut(r,n,s)&&(e=y-c,0<(h=t-a)/Math.sqrt(h*h+e*e)*Math.cos(i/180*Math.PI))):(t=c+(u=Math.tan(i/180*Math.PI))*((y=(l-c-((o=(d-l)/(v-f))*f-u*a))/(u-o))-a),r.x=y,r.y=t,!!this.Ut(r,n,s)&&(h=y-a,e=t-c,Math.abs(h)<=Hi&&Math.abs(e)<=Hi||0<h/Math.sqrt(h*h+e*e)*Math.cos(i/180*Math.PI)))},ni:function(t,i){return Math.abs(t.x-i.x)<P&&Math.abs(t.y-i.y)<P},si:function(t,i,n,s){var r,e,h,o,u=t.x,a=t.y,c=i.x,f=i.y,l=n.x,v=n.y;return this.ni(t,i)||this.ni(t,n)?(s.x=u,s.y=a,!0):(h=Math.min(i.x,n.x),o=Math.max(i.x,n.x),r=Math.min(i.y,n.y),e=Math.max(i.y,n.y),Math.abs(c-l)<1e-5?(s.x=c,r<=(s.y=a)&&a<=e):Math.abs(f-v)<1e-5?(s.x=u,s.y=f,h<=u&&u<=o):(o=a+(r=-1/((v-f)/(l-c)))*((h=(f-a-((e=(v-f)/(l-c))*c-r*u))/(r-e))-u),s.x=h,s.y=o,!!this.Ut(s,i,n)||!(!this.ni(t,i)&&!this.ni(t,n))))},ri:function(t,i){return{x:t.y*i.z-t.z*i.y,y:t.z*i.x-t.x*i.z,z:t.x*i.y-t.y*i.x}},ei:function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},hi:function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)},oi:function(t,i){return t.x*i.x+t.y*i.y},ui:function(t,i){return t.x*i.y-t.y*i.x},ai:function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},ci:function(t,i){var n,s;return 0==t.x&&0==t.y||0==i.x&&0==i.y?0:(n={x:t.x,y:t.y,z:0},s={x:i.x,y:i.y,z:0},n=this.ri(n,s),s=this.oi(t,i),s=Math.acos(s/(this.ai(t)*this.ai(i))),0<n.z?s/Math.PI*180:360-s/Math.PI*180)},fi:function(t,i,n,s){for(var r=0;r<n.length;r++){var e=n[r],h=n[(r+1)%n.length];if(1==this.ti(t,i,e,h,s))return!0}return!1},li:function(t,i,n,s,r){var e=Math.min(t.x,n.x,s.x),h=Math.max(t.x,n.x,s.x),o=Math.min(t.y,n.y,s.y),u=Math.max(t.y,n.y,s.y),h=Math.sqrt((h-e)*(h-e)+(u-o)*(u-o)),e=i/180*Math.PI,u=h*Math.cos(e)+t.x,o=h*Math.sin(e)+t.y;return 1==this.ti(t,{x:u,y:o},n,s,r)},vi:function(t){for(var i={x:null,y:null},n=0,s=0,r=0;r<t.length;r++)n+=t[r].x,s+=t[r].y;return i.x=n/t.length,i.y=s/t.length,i},di:function(t,i,n,s){var r=[],e=t.x-i,h=t.x+i,o=t.y-i,u=t.y+i,a=Math.min(n.x,s.x),c=Math.max(n.x,s.x),f=Math.min(n.y,s.y),l=Math.max(n.y,s.y);return c<e||h<a||l<o||u<f||(e=s.x-n.x,h=s.y-n.y,(o=(t=(e*(o=t.x-n.x)+h*(u=t.y-n.y))/(s=e*e+h*h))*t-(o*o+u*u-i*i)/s)<0)||(u=Math.sqrt(o),s={x:n.x-e*(i=-t+u),y:n.y-h*i},e={x:n.x-e*(o=-t-u),y:n.y-h*o},i!==o&&(a<=s.x&&s.x<=c&&f<=s.y&&s.y<=l&&r.push(s),a<=e.x)&&e.x<=c&&f<=e.y&&e.y<=l&&r.push(e)),r},yi:function(t,i,n){var s,r={};if(t.x!=i.x)return s=i=(i.y-t.y)/(i.x-t.x),i=t.y-i*t.x,r.x=(+n.x- -1*s*n.y-s*i)/(s*s+1),r.y=(s*s*n.y- -1*s*n.x- -1*i)/(s*s+1),r;r.x=t.x,r.y=n.y},pi:function(t,i,n,s){var r,e,h,o,u={point:null,isintersect:!1};return t==n||t==s?(u.isintersect=!0,u.point=t):i==n||i==s?(u.isintersect=!0,u.point=i):(r={x:i.x-t.x,y:i.y-t.y},e={x:s.x-n.x,y:s.y-n.y},h={x:n.x-t.x,y:n.y-t.y},s={x:s.x-t.x,y:s.y-t.y},i={x:i.x-n.x,y:i.y-n.y},n={x:-h.x,y:-h.y},o=this.ui(e,r),Math.abs(o)<=4e-9||this.ui(h,r)*this.ui(s,r)<=4e-9&&this.ui(n,e)*this.ui(i,e)<4e-9&&(s=this.ui(e,h)/o,u.point=t+r*s,u.isintersect=!0)),u}});var Xi=new t;function Ui(t){return(Ui="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Zi(t,i){for(var n=0;n<i.length;n++){var s=i[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,function(t){t=function(t,i){if("object"!==Ui(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===i?String:Number)(t);n=n.call(t,i||"default");if("object"!==Ui(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"===Ui(t)?t:String(t)}(s.key),s)}}t=function(){function i(t){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.P=t,this.$=this.P.getContainer(),this.mi={border:"border:2px solid #0000FF",backgroundColor:null,opacity:null},this.bi=[pi.MODEL,pi.FACILITY,pi.LABEL,pi.EXTERNAL_MODEL],this.Mi=0,this.wi=!1,this.tt=this.tt.bind(this),this.it=this.it.bind(this),this.nt=this.nt.bind(this),this.gi=null,this.Ai=null,this.rt=new oi,this.Ei=new fengmap.FMSearchAnalyser({map:this.P}),this.ot()}var t,n,s;return t=i,(n=[{key:"dispose",value:function(){this.$.removeEventListener("mousedown",this.tt,!1),document.removeEventListener("mousemove",this.it,!1),document.removeEventListener("mouseup",this.nt,!1),this.Ei.dispose()}},{key:"boxStyle",get:function(){return this.mi},set:function(t){this.mi=t}},{key:"enable",get:function(){return this.wi},set:function(t){this.wi=t}},{key:"mouseKey",get:function(){return 0===this.Mi?"left":"right"},set:function(t){this.Mi="left"===t?0:2}},{key:"types",get:function(){return this.bi},set:function(t){this.bi=t}},{key:"on",value:function(t,i){this.rt.k(t,i)}}])&&Zi(t.prototype,n),s&&Zi(t,s),Object.defineProperty(t,"prototype",{writable:!1}),i}(),Object.assign(t.prototype,{ot:function(){this.P.getRenderManager().renderer.domElement.style.left="0px",this.$.addEventListener("mousedown",this.tt,!1),document.addEventListener("mousemove",this.it,!1),document.addEventListener("mouseup",this.nt,!1)},Si:function(t){return{x:t.getBoundingClientRect().left,y:t.getBoundingClientRect().top}},tt:function(t){var i,n;this.wi&&t.button===this.Mi&&(this.gi&&this.gi.parentNode&&(this.gi.parentNode.removeChild(this.gi),this.gi=null),i=this.Si(this.P.getRenderManager().renderer.domElement),n=t.clientX-i.x,t=t.clientY-i.y,this.Ai={x:n,y:t},this.wt(!1),this.gi=document.createElement("div"),this.gi.style.cssText="position:absolute;top:"+t+"px;left:"+n+"px;width:0px;height:0px;"+this.mi.border+";",this.$.appendChild(this.gi),this.mi.backgroundColor&&(this.gi.style.backgroundColor=this.mi.backgroundColor),void 0!==this.mi.opacity)&&null!==this.mi.opacity&&(this.gi.style.opacity=this.mi.opacity)},it:function(t){var i,n;this.wi&&null!==this.Ai&&(i=this.Si(this.P.getRenderManager().renderer.domElement),n=t.clientX-i.x,t=t.clientY-i.y,n<this.Ai.x&&(this.gi.style.left=n+"px"),t<this.Ai.y&&(this.gi.style.top=t+"px"),this.gi.style.width=Math.abs(n-this.Ai.x)+"px",this.gi.style.height=Math.abs(t-this.Ai.y)+"px")},nt:function(t){var b=this;if(this.wi&&null!==this.gi&&t.button===this.Mi){this.wt(!0);var M=this.Ri(),s=[],i=this.P.getMapOptions(),n=[],r=[];if(i.buildings&&0<i.buildings.length)for(var e=0;e<i.buildings.length;e++)!function(t){for(var t=b.P.getBuilding(t).bound,i=t.min,t=t.max,n=[{x:i.x,y:i.y},{x:i.x,y:t.y},{x:t.x,y:t.y},{x:t.x,y:i.y}],s=0;s<n.length;s++)if(Xi.Zt(n[s],M,M.length))return 1;for(var r=0;r<M.length;r++)if(Xi.Zt(M[r],n,n.length))return 1;for(var e=0;e<M.length-1;e++){for(var h=M[e],o=M[e+1],u=0;u<n.length-1;u++){var a=n[u],c=n[u+1];if(Xi.Yt(h,o,a,c))return 1}var f=n[n.length-1],l=n[0];if(Xi.Yt(h,o,l,f))return 1}for(var v=M[0],d=M[M.length-1],y=0;y<n.length-1;y++){var p=n[y],m=n[y+1];if(Xi.Yt(v,d,p,m))return 1}t=n[n.length-1],i=n[0];if(Xi.Yt(v,d,i,t))return 1}(i.buildings[e].bid)||(n.push(i.buildings[e].mid),r.push(i.buildings[e].bid));for(var h=[],o=0;o<this.bi.length;o++){for(var u=new fengmap.FMSearchRequest,a=(u.levels=[this.P.getBuilding(i.buildingID).level],u.type=this.bi[o],u.addCondition({polygon:M}),[]),c=0;c<r.length;c++)a.push({buildingID:r[c],levels:[this.P.getBuilding(r[c]).level]});0<a.length&&(u.buildings=a),h.push(u)}this.Ai=null,this.gi.parentNode&&this.gi.parentNode.removeChild(this.gi),this.gi=null;var f,l=0;f=null,function i(){var n;l<h.length?(n=h[l],b.Ei.query(n,function(t){s.push({type:n.type,children:t}),l++,f=setTimeout(i(),1)})):(null!==f&&clearTimeout(f),b.rt.C({type:"boxselected",targets:s,coords:M}))}()}},wt:function(t){var i=this.P.getInteracations();i.enableDrag=t,i.enableRotate=t,i.enableTilt=t,i.enableZoom=t},Ri:function(){for(var t=[],i=this.gi.getBoundingClientRect(),n=this.Si(this.P.getRenderManager().renderer.domElement),s=n.x,n=n.y,r=(t.push({x:i.left-s,y:i.top-n}),t.push({x:i.right-s,y:i.top-n}),t.push({x:i.right-s,y:i.bottom-n}),t.push({x:i.left-s,y:i.bottom-n}),[]),e=0;e<t.length;e++){var h=fengmap.FMUtil.coordsScreenToMap(this.P,t[e]);r.push(h)}return r}});function Gi(t){return(Gi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function qi(t,i){for(var n=0;n<i.length;n++){var s=i[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,function(t){t=function(t,i){if("object"!==Gi(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===i?String:Number)(t);n=n.call(t,i||"default");if("object"!==Gi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"===Gi(t)?t:String(t)}(s.key),s)}}var zi=function(){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function")}var i,n,s;return i=t,s=[{key:"round",value:function(t){return 0<t.toFixed(2)?Math.ceil(t.toFixed(2)):Math.floor(t.toFixed(2))}},{key:"generateUUID",value:function(){for(var t=[],i=0;i<256;i++)t[i]=(i<16?"0":"")+i.toString(16);var n=4294967295*Math.random()|0,s=4294967295*Math.random()|0,r=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=t[255&n]+t[n>>8&255]+t[n>>16&255]+t[n>>24&255]+"-"+t[255&s]+t[s>>8&255]+"-"+t[s>>16&15|64]+t[s>>24&255]+"-"+t[63&r|128]+t[r>>8&255]+"-"+t[r>>16&255]+t[r>>24&255]+t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255];return t.length=0,n.toUpperCase()}},{key:"findNearNthPowerOfTwo",value:function(t){t-=1;return(t=(t=(t=(t=(t|=t>>1)|t>>2)|t>>4)|t>>8)|t>>16)<0?1:1+t}},{key:"rgbToArray",value:function(t){var i=new l;return i.setStyle(t),[i.r,i.g,i.b]}},{key:"toRgba",value:function(t){var i;return void 0===t?t:"number"!=typeof t?3<=(i=t.split(",")).length?"rgba("+parseInt(i[0])+","+parseInt(i[1])+","+parseInt(i[2])+",1)":t:"rgba("+parseInt(255*new l(t).r)+","+parseInt(255*new l(t).g)+","+parseInt(255*new l(t).b)+",1)"}},{key:"toColor",value:function(t){var i;return"number"==typeof t?t:3<=(i=t.split(",")).length?parseInt(i[0])<<16|parseInt(i[1])<<8|parseInt(i[2]):(console.error("color format error",t),0)}}],(n=null)&&qi(i.prototype,n),s&&qi(i,s),Object.defineProperty(i,"prototype",{writable:!1}),t}();function Qi(t){return(Qi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Wi(t,i){for(var n=0;n<i.length;n++){var s=i[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,function(t){t=function(t,i){if("object"!==Qi(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===i?String:Number)(t);n=n.call(t,i||"default");if("object"!==Qi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"===Qi(t)?t:String(t)}(s.key),s)}}function Ki(){return(Ki="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,i,n){var s=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=tn(t)););return t}(t,i);if(s)return(s=Object.getOwnPropertyDescriptor(s,i)).get?s.get.call(arguments.length<3?t:n):s.value}).apply(this,arguments)}function Ji(t,i){return(Ji=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t})(t,i)}function $i(n){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=tn(n),i=(t=s?(t=tn(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),this);if(t&&("object"===Qi(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==i)return i;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function tn(t){return(tn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var nn=function(t){var i=r;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),t&&Ji(i,t);var n,s=$i(r);function r(t){var i;if(this instanceof r)return(i=s.call(this,t)).info2=t,i.id=""+zi.generateUUID(),i.shapetype2="point",i.opetype2="no",t.opetype&&(i.opetype2=t.opetype,i.shapetype2="no"),i.mapEdit=null,i;throw new TypeError("Cannot call a class as a function")}return i=r,(t=[{key:"info",get:function(){return this.info2.id=this.id,this.info2.x=this.u,this.info2.y=this.v,this.info2.height=this._height,this.info2.shapetype=this.shapetype,this.info2.level=this.level,this.info2}},{key:"opetype",get:function(){if(this.opetype2)return{node:this.getRenderNode(),type:this.opetype2}}},{key:"shapetype",get:function(){return this.shapetype2}},{key:"deleteMarker",value:function(){Ki(tn(r.prototype),"remove",this).call(this)}}])&&Wi(i.prototype,t),n&&Wi(i,n),Object.defineProperty(i,"prototype",{writable:!1}),r}(fengmap.FMImageMarker);function sn(t){return(sn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function rn(t,i){for(var n=0;n<i.length;n++){var s=i[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,function(t){t=function(t,i){if("object"!==sn(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===i?String:Number)(t);n=n.call(t,i||"default");if("object"!==sn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"===sn(t)?t:String(t)}(s.key),s)}}function en(){return(en="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,i,n){var s=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=un(t)););return t}(t,i);if(s)return(s=Object.getOwnPropertyDescriptor(s,i)).get?s.get.call(arguments.length<3?t:n):s.value}).apply(this,arguments)}function hn(t,i){return(hn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t})(t,i)}function on(n){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=un(n),i=(t=s?(t=un(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),this);if(t&&("object"===sn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==i)return i;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function un(t){return(un=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var an=function(t){var i=r;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),t&&hn(i,t);var n,s=on(r);function r(t){var i;if(this instanceof r)return(i=s.call(this,t)).info2=t,i.shapetype2="polygon",i.id=""+zi.generateUUID(),t.shapetype&&(i.shapetype2=t.shapetype),i.mapEdit=null,i;throw new TypeError("Cannot call a class as a function")}return i=r,(t=[{key:"info",get:function(){return this.info2.id=this.id,this.info2.shapetype=this.shapetype2,this.info2.level=this.level,this.info2.buildingID=this.parent.parent.parent.buildingID,this.info2}},{key:"shapetype",get:function(){return this.shapetype2}},{key:"deleteMarker",value:function(){if(en(un(r.prototype),"remove",this).call(this),null!==this.mapEdit&&this.mapEdit.G&&this.mapEdit.G.id===this.id){for(var t=0;t<this.mapEdit.X.length;t++)this.mapEdit.X[t].remove();this.mapEdit.X.length=0}}}])&&rn(i.prototype,t),n&&rn(i,n),Object.defineProperty(i,"prototype",{writable:!1}),r}(fengmap.FMPolygonMarker);function cn(t){return(cn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function fn(t,i){for(var n=0;n<i.length;n++){var s=i[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,function(t){t=function(t,i){if("object"!==cn(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===i?String:Number)(t);n=n.call(t,i||"default");if("object"!==cn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"===cn(t)?t:String(t)}(s.key),s)}}function ln(){return(ln="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,i,n){var s=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=yn(t)););return t}(t,i);if(s)return(s=Object.getOwnPropertyDescriptor(s,i)).get?s.get.call(arguments.length<3?t:n):s.value}).apply(this,arguments)}function vn(t,i){return(vn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t})(t,i)}function dn(n){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=yn(n),i=(t=s?(t=yn(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),this);if(t&&("object"===cn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==i)return i;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function yn(t){return(yn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var pn=function(t){var i=r;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),t&&vn(i,t);var n,s=dn(r);function r(t){var i;if(this instanceof r)return(i=s.call(this,t)).shapetype2="line",i.info2=t,i.id=""+zi.generateUUID(),i.mapEdit=null,i;throw new TypeError("Cannot call a class as a function")}return i=r,(t=[{key:"info",get:function(){return this.info2.id=this.id,this.info2.points=this.points,this.info2.shapetype=this.shapetype,this.info2.level=this.segments[0].level,this.info2.buildingID=this.segments[0].buildingID,this.info2}},{key:"points",get:function(){return 0===this.segments.length?[]:this.segments[0].points}},{key:"shapetype",get:function(){return this.shapetype2}},{key:"deleteMarker",value:function(){if(ln(yn(r.prototype),"remove",this).call(this),null!==this.mapEdit&&this.mapEdit.G&&this.mapEdit.G.id===this.id){for(var t=0;t<this.mapEdit.X.length;t++)this.mapEdit.X[t].remove();this.mapEdit.X.length=0}}}])&&fn(i.prototype,t),n&&fn(i,n),Object.defineProperty(i,"prototype",{writable:!1}),r}(fengmap.FMLineMarker);function mn(t){return(mn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function bn(t,i){for(var n=0;n<i.length;n++){var s=i[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,function(t){t=function(t,i){if("object"!==mn(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===i?String:Number)(t);n=n.call(t,i||"default");if("object"!==mn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"===mn(t)?t:String(t)}(s.key),s)}}var Mn=function(){function i(t){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.P=t.map,this.$=this.P.getContainer(),this.ji=t.highlightColor,void 0===this.ji&&(this.ji="#FF0000"),this.xi=t.radius,void 0===this.xi&&(this.xi=1),this.it=this.it.bind(this),this.st=new it,this.st.params.Line.threshold=this.xi,this.rt=new oi,this.Oi=[],this.Ti={},this.ot()}var t,n,s;return t=i,(n=[{key:"removeTargets",value:function(){for(var t=0;t<this.Oi.length;t++)this.Oi[t].parent.remove(this.Oi[t]);this.Ti={},this.Oi.length=0}},{key:"addTargets",value:function(t){this.removeTargets();for(var i=0;i<t.length;i++)if(t[i].type===fengmap.FMType.LINE_MARKER){for(var n=t[i].segments[0].points,s=[],r=0;r<n.length;r++)s.push(new w(n[r].x-this.P.x,n[r].z,-n[r].y+this.P.y));var e=new B({visible:!1}),e=new si((new Qt).setFromPoints(s),e);e.myobject=t[i],e.mapNode=t[i],t[i].parent.scene.add(e),this.Oi.push(e)}else if(t[i].type===fengmap.FMType.POLYGON_MARKER&&t[i].getRenderNode()){this.Ti[""+t[i].id]={borderColor:t[i].borderColor,color:t[i].color};for(var h=t[i].points,o=[],u=0;u<h.length;u++)o.push(new w(h[u].x-this.P.x,t[i].height,-h[u].y+this.P.y));var e=new B({visible:!1}),a=new si((new Qt).setFromPoints(o),e);a.myobject=t[i],a.mapNode=t[i],t[i].getRenderNode().parent.add(a),this.Oi.push(a)}}},{key:"dispose",value:function(){this.removeTargets(),this.Oi.length=0,this.$.removeEventListener("mousemove",this.it,!1)}},{key:"radius",get:function(){return this.xi},set:function(t){this.xi=t,this.st.params.Line.threshold=this.xi}},{key:"on",value:function(t,i){this.rt.k(t,i)}}])&&bn(t.prototype,n),s&&bn(t,s),Object.defineProperty(t,"prototype",{writable:!1}),i}();Object.assign(Mn.prototype,{ot:function(){this.$.addEventListener("mousemove",this.it,!1)},it:function(t){if(0!==this.Oi.length){for(var n=this,i=new E,s=this.$.getBoundingClientRect(),i=(i.x=(t.clientX-s.left)/s.width*2-1,i.y=2*-((t.clientY-s.top)/s.height)+1,this.st.setFromCamera(i,this.P.camera),t.clientX-s.left),t=t.clientY-s.top,s=fengmap.FMUtil.coordsScreenToMap(this.P,{x:i,y:t}),r=this.st.intersectObjects(function(){for(var t=[],i=0;i<n.Oi.length;i++)n.Oi[i].mapNode&&n.Oi[i].mapNode.level&&n.Oi[i].mapNode.level===n.P.getLevel()&&t.push(n.Oi[i]);return t}(this.Oi),!0),e=[],h=[],o=0;o<r.length;o++)!function(t,i){for(var n=!0,s=0;s<t.length;s++)if(t[s].uuid===i.uuid){n=!1;break}return n}(e,r[o].object)||(e.push(r[o].object),h.push(r[o].point));var u=[],a=[];if(0<e.length){for(var c=0;c<e.length;c++){u.push(e[c].myobject);var f=h[c];a.push({x:f.x+this.P.x,y:this.P.y-f.z})}for(var l=s,v=u,d=a,y=0;y<v.length-1;y++)for(var p=0;p<v.length-1-y;p++){var m=Math.sqrt((v[p].x-l.x)*(v[p].x-l.x)+(v[p].y-l.y)*(v[p].y-l.y));Math.sqrt((v[p+1].x-l.x)*(v[p+1].x-l.x)+(v[p+1].y-l.y)*(v[p+1].y-l.y))<m&&(m=v[p],v[p]=v[p+1],v[p+1]=m,m=d[p],d[p]=d[p+1],d[p+1]=m)}}0===u.length&&(a=u=null);for(var b=0;b<this.Oi.length;b++){var M=this.Ti[""+this.Oi[b].myobject.id];M&&(this.Oi[b].myobject.color=M.color,this.Oi[b].myobject.borderColor=M.borderColor)}null!==u&&u[0].type===fengmap.FMType.POLYGON_MARKER&&(u[0].color=this.ji,u[0].borderColor=this.ji),this.rt.C({type:"snap",coords:s,targets:u,targetsCoords:a,level:this.P.getLevel()})}}});function wn(t){return(wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function gn(t,i){return function(t){if(Array.isArray(t))return t}(t)||function(t,i){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var s,r,e,h,o=[],u=!0,a=!1;try{if(e=(n=n.call(t)).next,0===i){if(Object(n)!==n)return;u=!1}else for(;!(u=(s=e.call(n)).done)&&(o.push(s.value),o.length!==i);u=!0);}catch(t){a=!0,r=t}finally{try{if(!u&&null!=n.return&&(h=n.return(),Object(h)!==h))return}finally{if(a)throw r}}return o}}(t,i)||En(t,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function An(t,i){var n,s,r,e,h="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(h)return s=!(n=!0),{s:function(){h=h.call(t)},n:function(){var t=h.next();return n=t.done,t},e:function(t){s=!0,r=t},f:function(){try{n||null==h.return||h.return()}finally{if(s)throw r}}};if(Array.isArray(t)||(h=En(t))||i&&t&&"number"==typeof t.length)return h&&(t=h),e=0,{s:i=function(){},n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:i};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function En(t,i){var n;if(t)return"string"==typeof t?Sn(t,i):"Map"===(n="Object"===(n=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Sn(t,i):void 0}function Sn(t,i){(null==i||i>t.length)&&(i=t.length);for(var n=0,s=new Array(i);n<i;n++)s[n]=t[n];return s}function Rn(t,i){for(var n=0;n<i.length;n++){var s=i[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,function(t){t=function(t,i){if("object"!==wn(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===i?String:Number)(t);n=n.call(t,i||"default");if("object"!==wn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"===wn(t)?t:String(t)}(s.key),s)}}var jn=function(){function i(t){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.P=t.map,this.ki=t.defaultStyle,this.Bi=new Map,this.Ii=new Map,this.Ci=this.Ci.bind(this),this.P.on("beforeRender",this.Ci)}var t,n,s;return t=i,(n=[{key:"add",value:function(t){var i=this;if(void 0===t.buildingID&&(t.buildingID=this.P.getMapOptions().mapID),void 0===t.type&&(t.type=1),void 0===t.levels){t.levels=[];for(var n=this.P.getBuilding(t.buildingID).getFloorInfos(),s=0;s<n.length;s++)t.levels.push(n[s].level)}for(var r=t.result,e=t.levels,h=t.roadRanks,o=0;o<e.length;o++)for(var u=0;u<h.length;u++)for(var a=function(t,i,n){for(var s=[],r=0;r<t.length;r++)if(""+t[r].level==""+i)for(var e=t[r].roadVector,h=0;h<e.length;h++)""+e[h].roadRank==""+n&&s.push(e[h]);return s}(r,e[o],h[u]),c=(m=p=y=d=v=l=f=c=void 0,t.type),f=e[o],l=t.height,v=h[u],d=a,y=t.zoomRange,p=i.Pi(v),m=0;m<d.length;m++)d[m].buildingID||(d[m].buildingID=i.P.getMapOptions().mapID),""+c=="1"?(i.Vi(p,f,l,v,d[m].startPoint,d[m].startId,y,d[m].buildingID),i.Vi(p,f,l,v,d[m].endPoint,d[m].endId,y,d[m].buildingID),i._i(p,f,l,v,d[m].startPoint,d[m].endPoint,y,d[m].buildingID)):""+c=="2"?i._i(p,f,l,v,d[m].startPoint,d[m].endPoint,y,d[m].buildingID):""+c=="3"&&(i.Vi(p,f,l,v,d[m].startPoint,d[m].startId,y,d[m].buildingID),i.Vi(p,f,l,v,d[m].endPoint,d[m].endId,y,d[m].buildingID))}},{key:"getNaviLineByRanks",value:function(t){var i=t.roadRanks,n=t.levels;if(void 0===t.buildingID&&(t.buildingID=this.P.getMapOptions().mapID),void 0===n)for(var n=[],s=this.P.getBuilding(t.buildingID).getFloorInfos(),r=0;r<s.length;r++)n.push(s[r].level);for(var e=[],h=0;h<n.length;h++){var o=this.Ii.get(t.buildingID+""+n[h]);if(o)for(var u=0;u<o.length;u++)this.Fi(o[u].roadRank,i)&&e.push(o[u].object)}return e}},{key:"getNaviNodeByRanks",value:function(t){var i=t.roadRanks,n=t.levels;if(void 0===t.buildingID&&(t.buildingID=this.P.getMapOptions().mapID),void 0===n)for(var n=[],s=this.P.getBuilding(t.buildingID).getFloorInfos(),r=0;r<s.length;r++)n.push(s[r].level);for(var e=[],h=0;h<n.length;h++){var o=this.Bi.get(t.buildingID+""+n[h]);if(o)for(var u=0;u<o.length;u++)this.Fi(o[u].roadRank,i)&&e.push(o[u].object)}return e}},{key:"remove",value:function(r){for(var e=this,t=(void 0===r.buildingID&&(r.buildingID=this.P.getMapOptions().mapID),r.type),i=(void 0===t&&(t=1),r.levels),n=r.roadRanks,s=0;s<i.length;s++)for(var h=0;h<n.length;h++)""+t=="1"?(o(i[s],n[h]),u(i[s],n[h])):""+t=="2"?o(i[s],n[h]):""+t=="3"&&u(i[s],n[h]);function o(t,i){for(var n=e.Ii.get(r.buildingID+""+t),s=a(n,i);-1!==s;)n[s].object.remove(),n.splice(s,1),s=a(n,i)}function u(t,i){for(var n=e.Bi.get(r.buildingID+""+t),s=a(n,i);-1!==s;)n[s].object.remove(),n.splice(s,1),s=a(n,i)}function a(t,i){for(var n=-1,s=0;s<t.length;s++)if(""+t[s].roadRank==""+i){n=s;break}return n}}},{key:"changeVisible",value:function(t){}},{key:"dispose",value:function(){var t,i=An(this.Bi);try{for(i.s();!(t=i.n()).done;){for(var n=gn(t.value,2),s=(n[0],n[1]),r=0;r<s.length;r++)s[r].object.remove();s.length=0}}catch(t){i.e(t)}finally{i.f()}var e,h=An(this.Ii);try{for(h.s();!(e=h.n()).done;){for(var o=gn(e.value,2),u=(o[0],o[1]),a=0;a<u.length;a++)u[a].object.remove();u.length=0}}catch(t){h.e(t)}finally{h.f()}this.Ii.clear(),this.Bi.clear(),this.P.on("beforeRender",this.Ci)}}])&&Rn(t.prototype,n),s&&Rn(t,s),Object.defineProperty(t,"prototype",{writable:!1}),i}(),xn=(Object.assign(jn.prototype,{Pi:function(t){for(var i=null,n=0;n<this.ki.length;n++)if(""+this.ki[n].roadRank==""+t){i=this.ki[n];break}return i},_i:function(t,i,n,s,r,e,h,o){var u=new fengmap.FMSegment,r=(u.points=[{x:r.x,y:r.y,z:n},{x:e.x,y:e.y,z:n}],u.level=i,u.buildingID=o,new fengmap.FMLineMarker({segments:[u],width:t.lineWidth,color:t.lineColor,type:fengmap.FMLineType.FULL})),e=(r.addTo(this.P),this.Ii.get(o+""+i));e?e.push({roadRank:s,object:r,zoomRange:h}):this.Ii.set(o+""+i,[{roadRank:s,object:r,zoomRange:h}])},Vi:function(t,i,n,s,r,e,h,o){var u;this.Li(o+""+i,e)&&(u={x:r.x,y:r.y},u={points:fengmap.FMCalculator.rectangleBuilder(t.pointSize,t.pointSize,u),x:r.x,y:r.y,height:n,color:t.pointColor,borderWidth:0,opacity:1},r=this.P.getBuilding(o).getFloor(i),(n=new fengmap.FMPolygonMarker(u)).addTo(r),n.id=e,(t=this.Bi.get(o+""+i))?t.push({roadRank:s,object:n,zoomRange:h}):this.Bi.set(o+""+i,[{roadRank:s,object:n,zoomRange:h}]))},Li:function(t,i){var n,s=!0,r=An(this.Bi);try{for(r.s();!(n=r.n()).done;){var e=gn(n.value,2),h=e[0],o=e[1];if(""+h==""+t)for(var u=0;u<o.length;u++)if(""+o[u].object.id==""+i){s=!1;break}if(!s)break}}catch(t){r.e(t)}finally{r.f()}return s},Fi:function(t,i){for(var n=!1,s=0;s<i.length;s++)if(""+i[s]==""+t){n=!0;break}return n},Ci:function(){for(var t=this.P.camera,i=this.P.getVisibleLevels(),n=this.P.getZoom(),s=0;s<i.length;s++){var r=this.P.getFloor(i[s]),e=this.Ii.get(""+i[s]);if(e)for(var h,o,u=0;u<e.length;u++)n<e[u].zoomRange[0]||n>e[u].zoomRange[1]?e[u].object.parent&&e[u].object.remove():(h=new w((o=e[u].object.segments[0].points)[0].x-this.P.x,o[0].z+r.height,-o[0].y+this.P.y),o=new w(o[1].x-this.P.x,o[1].z+r.height,-o[1].y+this.P.y),h=h.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix),o=o.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix),!(1<Math.abs(h.x)||1<Math.abs(h.y)||1<Math.abs(h.z))||!(1<Math.abs(o.x)||1<Math.abs(o.y)||1<Math.abs(o.z))?e[u].object.parent||e[u].object.addTo(this.P):e[u].object.parent&&e[u].object.remove());var a=this.Bi.get(""+i[s]);if(a)for(var c=0;c<a.length;c++){var f,l=a[c].object;n<a[c].zoomRange[0]||n>a[c].zoomRange[1]?l.parent&&l.remove():(f=new w(l.x-this.P.x,l.height+r.height,-l.y+this.P.y).applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix),1<Math.abs(f.x)||1<Math.abs(f.y)||1<Math.abs(f.z)?l.parent&&l.remove():l.parent||l.addTo(r))}}this.P.enableUpdateRender()}}),"v3.1.3"),On=653,V=window.fengmap||{};V.VERSION=xn,V.BUILD=On,V.FMMapEditor=L,V.FMBoxSelectTool=t,V.FMImageMarkerEdit=nn,V.FMPolygonMarkerEdit=an,V.FMLineMarkerEdit=pn,V.FMSnapCtrl=Mn,V.FMNaviPathLineTool=jn,F.default=V}],s={},r.m=n,r.c=s,r.d=function(t,i,n){r.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"Di",{value:!0})},r.t=function(i,t){if(1&t&&(i=r(i)),8&t)return i;if(4&t&&"object"==typeof i&&i&&i.Di)return i;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:i}),2&t&&"string"!=typeof i)for(var s in i)r.d(n,s,function(t){return i[t]}.bind(null,s));return n},r.n=function(t){var i=t&&t.Di?function(){return t.default}:function(){return t};return r.d(i,"a",i),i},r.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},r.p="",r(r.s=0).default;function r(t){var i;return(s[t]||(i=s[t]={i:t,l:!1,exports:{}},n[t].call(i.exports,i,i.exports,r),i.l=!0,i)).exports}var n,s});